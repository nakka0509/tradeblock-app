<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Trade Block</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- BASE STYLES --- */
        :root {
            /* Light Theme (Default) */
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #1E293B;
            --text-sub: #64748B;
            --primary: #10B981;
            /* Emerald 500 */
            --danger: #EF4444;
            /* Red 500 */
            --border: #E2E8F0;
            --accent-gold: #D97706;
            /* Amber 600 */
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .dark {
            /* Dark Theme */
            --bg-color: #111827;
            --card-bg: #1F2937;
            --text-color: #F3F4F6;
            --text-sub: #9CA3AF;
            --border: #374151;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        .theme-gold {
            /* Gold Theme (Premium) */
            --bg-color: #000000;
            --card-bg: #000000;
            --text-color: #D4AF37;
            /* Genuine Gold */
            --text-sub: #A3A3A3;
            --primary: #D4AF37;
            --danger: #B91C1C;
            --border: #D4AF37;
            --shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            color: var(--text-color);
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* --- APP CONTAINER --- */
        #app-frame {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        /* --- COMPONENTS --- */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 9999px;
            font-weight: 800;
            text-align: center;
            transition: transform 0.1s active;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            font-size: 1.125rem;
            /* text-lg */
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background-color: var(--primary);
            color: #FFFFFF;
        }

        .theme-gold .btn-primary {
            background: linear-gradient(135deg, #FFE082 0%, #B7892B 100%);
            color: #000000;
            text-shadow: none;
            border: 1px solid #FFF;
        }

        .btn-gold {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .theme-gold .btn-gold {
            background: linear-gradient(135deg, #FFE082 0%, #B7892B 100%);
            color: black;
            text-shadow: none;
            border: 1px solid #FFF;
        }

        /* Range Slider Customization */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: var(--primary);
            margin-top: -10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
            cursor: pointer;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            cursor: pointer;
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Chart Canvas */
        #bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 65%;
            z-index: 0;
            opacity: 0.5;
            pointer-events: none;
        }

        .theme-gold #bg-canvas {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div id="app-frame" class="fade-in">
        <!-- CANVAS BACK -->
        <canvas id="bg-canvas"></canvas>

        <!-- HEADER -->
        <header
            class="relative z-10 p-6 flex justify-between items-start bg-gradient-to-b from-[var(--bg-color)] to-transparent pointer-events-none">
            <div class="pointer-events-auto">
                <h1 class="text-3xl font-black italic tracking-tighter leading-tight text-transparent bg-clip-text bg-gradient-to-r from-[var(--text-color)] to-[var(--text-sub)] pr-2 py-1"
                    style="font-family: 'Inter', sans-serif;">TRADE BLOCK</h1>
                <p class="text-sm font-bold opacity-60 mt-0 tracking-widest pl-1">ãƒˆãƒ¬ãƒ¼ãƒ‰ ãƒ–ãƒ­ãƒƒã‚¯</p>
            </div>
        </header>

        <!-- MAIN SCROLLABLE CONTENT -->
        <main id="main-content" class="relative z-10 flex-1 overflow-y-auto no-scrollbar p-6 pt-0 pb-36">
            <!-- Dynamic Content -->
        </main>

        <!-- BOTTOM NAVIGATION -->
        <nav
            class="absolute bottom-0 w-full bg-[var(--card-bg)]/95 backdrop-blur-md border-t border-[var(--border)] z-40 pb-4 pt-2 px-6 flex justify-between shadow-lg">
            <button onclick="app.setTab('home')" class="flex flex-col items-center flex-1 gap-1 group nav-btn"
                data-tab="home">
                <span class="text-3xl filter grayscale group-hover:grayscale-0 transition">ğŸ </span>
                <span class="text-xs font-bold mt-1">TIMER</span>
            </button>
            <button onclick="app.setTab('records')" class="flex flex-col items-center flex-1 gap-1 group nav-btn"
                data-tab="records">
                <span class="text-3xl filter grayscale group-hover:grayscale-0 transition">ğŸ“’</span>
                <span class="text-xs font-bold mt-1">RECORDS</span>
            </button>
            <button onclick="app.setTab('settings')" class="flex flex-col items-center flex-1 gap-1 group nav-btn"
                data-tab="settings">
                <span class="text-3xl filter grayscale group-hover:grayscale-0 transition">âš™ï¸</span>
                <span class="text-xs font-bold mt-1">SETTINGS</span>
            </button>
        </nav>

        <!-- MODAL OVERLAY -->
        <div id="modal-container"
            class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fade-in">
            <!-- Injected Modal Content -->
        </div>
    </div>

    <script>
        /*******************************************************
         * TRADE BLOCK V6.6 - iOS READY
         *******************************************************/

        // --- FEATURE FLAGS ---
        // Set this to true before App Store upload to disable cheap dev unblocks and free premium
        const IS_PRODUCTION = false; // Temporarily false so you can test without App Store Connect setup!
        // ---------------------
        const CONSTANTS = {
            DEFAULT_FEE: 500,
            MIN_FEE: 100,
            MAX_FEE: 100000,
            STEP_FEE: 100,
            SECURE_PROFIT_HOUR: 7,
            RECORDS_KEY: 'tradeblock_records_v1'
        };

        // â”€â”€â”€ INVESTOR QUOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const QUOTES = {
            ja: [
                { text: "ç›¸å ´ã¯ã€å¿è€ã§ãã‚‹è€…ã®ã‚‚ã®ã ã€‚", author: "ã‚¸ã‚§ã‚·ãƒ¼ãƒ»ãƒªãƒãƒ¢ã‚¢" },
                { text: "æåˆ‡ã‚Šã¯æ—©ãã€åˆ©é£Ÿã„ã¯ã‚†ã£ãã‚Šã€‚", author: "ã‚¦ã‚©ãƒ¼ãƒ«è¡—ã®æ ¼è¨€" },
                { text: "ãƒªã‚¹ã‚¯ãªãã—ã¦å ±é…¬ãªã—ã€‚ã—ã‹ã—ç®¡ç†ã•ã‚ŒãŸãƒªã‚¹ã‚¯ã ã‘ãŒæ­£ã—ã„ãƒªã‚¹ã‚¯ã ã€‚", author: "ãƒãƒ¼ãƒ«ãƒ»ãƒãƒ¥ãƒ¼ãƒ€ãƒ¼ãƒ»ã‚¸ãƒ§ãƒ¼ãƒ³ã‚º" },
                { text: "ç›¸å ´ã¸ã®ææ€–ã¨æ¬²æœ›ã‚’åˆ¶å¾¡ã§ããŸè€…ãŒå‹è€…ã¨ãªã‚‹ã€‚", author: "ã‚¦ã‚©ãƒ¼ãƒ¬ãƒ³ãƒ»ãƒãƒ•ã‚§ãƒƒãƒˆ" },
                { text: "æœ€é«˜ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã¯ã€æ™‚ã¨ã—ã¦ä½•ã‚‚ã—ãªã„ã“ã¨ã ã€‚", author: "ã‚¸ã‚§ã‚·ãƒ¼ãƒ»ãƒªãƒãƒ¢ã‚¢" },
                { text: "å¸‚å ´ã¯ã‚ãªãŸã®æ„è¦‹ã‚’èã„ã¦ãã‚Œãªã„ã€‚ã‚ãªãŸãŒå¸‚å ´ã«å¾“ã†ã—ã‹ãªã„ã€‚", author: "ãƒ‹ã‚³ãƒ©ã‚¹ãƒ»ãƒ€ãƒ¼ãƒ“ãƒ£ã‚·ãƒ£ãƒ¼" },
                { text: "è¦å¾‹ã“ããŒã€ãƒ—ãƒ­ã¨ã‚¢ãƒãƒãƒ¥ã‚¢ã‚’åˆ†ã‘ã‚‹å”¯ä¸€ã®å£ã ã€‚", author: "ãƒãƒ¼ã‚¯ãƒ»ãƒ€ã‚°ãƒ©ã‚¹" },
                { text: "æ„Ÿæƒ…ã¯æœ€æ‚ªã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã ã€‚æ•°å­—ã ã‘ã‚’ä¿¡ã˜ã‚ã€‚", author: "ã‚¸ãƒ§ãƒ¼ã‚¸ãƒ»ã‚½ãƒ­ã‚¹" },
            ],
            en: [
                { text: "The stock market is designed to transfer money from the active to the patient.", author: "Warren Buffett" },
                { text: "Cut your losses short. Let your profits run.", author: "Wall Street Adage" },
                { text: "I go for the jugular when I have a conviction.", author: "George Soros" },
                { text: "The most important quality for an investor is temperament, not intellect.", author: "Warren Buffett" },
                { text: "The best trade is no trade when conditions aren't right.", author: "Jesse Livermore" },
                { text: "Discipline is the bridge between goals and accomplishment.", author: "Jim Rohn" },
                { text: "Markets are never wrong, opinions often are.", author: "Jesse Livermore" },
                { text: "Risk comes from not knowing what you're doing.", author: "Warren Buffett" },
            ]
        };

        // â”€â”€â”€ UNLOCK QUESTION SETS (RANDOMIZED) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const QUESTION_SETS = {
            ja: [
                // Set A: Entry criteria
                [
                    "ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ«ãƒ¼ãƒ«ã«å®Œå…¨ã«å‰‡ã£ãŸãƒˆãƒ¬ãƒ¼ãƒ‰ã‚’è¡Œãˆã¾ã™ã‹ï¼Ÿ",
                    "è¡å‹•çš„ãƒ»ãƒªãƒ™ãƒ³ã‚¸ç›®çš„ã§ãªã„ã¨ç¢ºèªã§ãã¾ã™ã‹ï¼Ÿ",
                    "ç¾åœ¨ã®ç›¸å ´ã¯ã€ã‚ãªãŸã®å¾—æ„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã‹ï¼Ÿ",
                    "é©åˆ‡ãªãƒ­ãƒƒãƒˆã‚µã‚¤ã‚ºã§å…¥ã‚‹æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "æå¤±ãŒå‡ºã¦ã‚‚å†·é™ã«å—ã‘å…¥ã‚Œã‚‹ç²¾ç¥çŠ¶æ…‹ã§ã™ã‹ï¼Ÿ"
                ],
                // Set B: Emotional state
                [
                    "ä»Šã€å†·é™ãªåˆ¤æ–­ãŒã§ãã¦ã„ã¦ã€è¡å‹•ã§ã¯ãªã„ã¨æ–­è¨€ã§ãã¾ã™ã‹ï¼Ÿ",
                    "ç›´è¿‘ã®æå¤±ã‚’å–ã‚Šè¿”ãã†ã¨ã—ã¦ã„ãªã„ã¨èª“ãˆã¾ã™ã‹ï¼Ÿ",
                    "ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³ã¯ä»Šæ—¥ã®æœã‹ã‚‰æº–å‚™ã—ã¾ã—ãŸã‹ï¼Ÿ",
                    "æåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ã¯æ˜ç¢ºã«æ±ºã‚ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ãŒæœ€å¾Œã®1å›ã ã¨ã—ã¦ã‚‚åŒã˜åˆ¤æ–­ã‚’ã—ã¾ã™ã‹ï¼Ÿ"
                ],
                // Set C: Post-win overconfidence
                [
                    "ç›´è¿‘ã®å‹ã¡ã‚’éä¿¡ã›ãšã€å¸¸ã«è¦å¾‹ã‚’ç¶­æŒã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "ä»Šæ—¥ã™ã§ã«ååˆ†ãªåˆ©ç›ŠãŒå‡ºã¦ã„ã‚‹å ´åˆã€ãã‚Œã§ã‚‚å¿…è¦ãªãƒˆãƒ¬ãƒ¼ãƒ‰ã§ã™ã‹ï¼Ÿ",
                    "æ™®æ®µé€šã‚Šã®ãƒ­ãƒƒãƒˆã‚µã‚¤ã‚ºã§ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã™ã‚‹ã¨ç´„æŸã§ãã¾ã™ã‹ï¼Ÿ",
                    "ã“ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚’é€ƒã—ã¦ã‚‚ã€æ¬¡ã®ãƒãƒ£ãƒ³ã‚¹ãŒå¿…ãšæ¥ã‚‹ã¨ã‚ã‹ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "æ˜æ—¥ã‚‚åŒã˜ãƒãƒ£ãƒ³ã‚¹ãŒæ¥ã‚‹ã¨ç¢ºä¿¡ã—ã€ä»Šæ—¥ã®æ¬²ã‚’æŠ‘ãˆã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ"
                ],
                // Set D: Late night / fatigue
                [
                    "ä»Šã€ååˆ†ã«ä¼‘æ¯ãŒå–ã‚ŒãŸçŠ¶æ…‹ã§ã™ã‹ï¼Ÿ",
                    "é›†ä¸­åŠ›ã¯æœ€é«˜ã®çŠ¶æ…‹ã§ã™ã‹ï¼Ÿ",
                    "ç–²ã‚Œã‚„ç„¦ã‚Šã§ãªãã€ç´”ç²‹ã«ãƒãƒ£ãƒ³ã‚¹ã‚’è¦‹ã¦ãƒˆãƒ¬ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‰æšæ•°ã¯è¦å®šå†…ã«åã¾ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                    "ç¿Œæœã¾ã§å¾…ã¦ãªã„ç†ç”±ãªã©æœ¬å½“ã«ãªã„ã¨ã€æ­£ç›´ã«è¨€ãˆã¾ã™ã‹ï¼Ÿ"
                ]
            ],
            en: [
                // Set A
                [
                    "Can you trade strictly according to your entry rules?",
                    "Can you confirm you are NOT trading impulsively or for revenge?",
                    "Is the current market your anticipated winning pattern?",
                    "Are you prepared with proper lot size and risk management?",
                    "Are you in a state to calmly accept a loss if it occurs?"
                ],
                // Set B
                [
                    "Are you emotionally calm â€” not just forcing a trade?",
                    "Can you confirm you are NOT trying to recover a recent loss?",
                    "Did you create your trade plan this morning?",
                    "Have you clearly decided your stop-loss level?",
                    "Would you make the same decision if this were your only trade today?"
                ],
                // Set C
                [
                    "Can you confirm you are NOT overconfident after recent wins?",
                    "If you already hit your target today, is this trade still necessary?",
                    "Can you commit to using your regular position size only?",
                    "Do you know the same or better opportunity will come again tomorrow?",
                    "If you miss this trade, do you trust another chance will come?"
                ],
                // Set D
                [
                    "Are you well-rested and focused right now?",
                    "Is your concentration at its peak?",
                    "Are you trading for a clear reason â€” not out of boredom or fatigue?",
                    "Are you within your daily trade limit?",
                    "Can you honestly say this cannot wait until tomorrow morning?"
                ]
            ]
        };

        const I18N = {
            ja: {
                tab_home: "ã‚¿ã‚¤ãƒãƒ¼", tab_history: "è¨˜éŒ²", tab_settings: "è¨­å®š", tab_records: "è¨˜éŒ²",
                lock_btn: "ãƒ­ãƒƒã‚¯é–‹å§‹", secure_profit_btn: "å‹ã¡é€ƒã’ (ç¿Œæœ07:00ã¾ã§)",
                time_remain: "æ®‹ã‚Šæ™‚é–“",
                history_title: "å¼·åˆ¶è§£é™¤å±¥æ­´", no_history: "å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“",
                records_title: "ãƒˆãƒ¬ãƒ¼ãƒ‰è¨˜éŒ²", no_records: "ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“",
                record_add: "è¨˜éŒ²ã‚’è¿½åŠ ", record_win: "å‹ã¡", record_loss: "è² ã‘", record_be: "ãƒˆãƒ³",
                record_pnl: "æç›Šé¡", record_note: "ãƒ¡ãƒ¢", record_save: "ä¿å­˜",
                record_delete: "å‰Šé™¤", record_confirm_delete: "ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ",
                memo_label: "ãƒ­ãƒƒã‚¯æ™‚ã®ãƒ¡ãƒ¢", memo_placeholder: "ä¸€è¨€(å¸‚å ´çŠ¶æ³ã€ç›®æ¨™ãªã©)ã‚’å…¥åŠ›...",
                memo_in_unlock: "ãƒ­ãƒƒã‚¯æ™‚ã®è‡ªåˆ†ã¸ã®ãƒ¡ãƒ¢",
                settings_title: "è¨­å®š", theme: "ãƒ†ãƒ¼ãƒ", blocked_apps: "ãƒ–ãƒ­ãƒƒã‚¯ã‚¢ãƒ—ãƒª", select: "é¸æŠ",
                premium_title: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³",
                secure_subhead: "å‹ã£ãŸã¾ã¾ä»Šæ—¥ã‚’çµ‚äº†ã™ã‚‹",
                sub_monthly: "æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ (7æ—¥é–“ç„¡æ–™)",
                upgrade_cta: "ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦æ©Ÿèƒ½ã‚’è§£æ”¾",
                confirm_title: "æœ€çµ‚ç¢ºèª", confirm_desc: "ä»¥ä¸‹ã®ãƒªã‚¹ã‚¯ã«åŒæ„ã—ã¦ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚",
                chk_risk: "ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ã¾ã—ãŸ", chk_agree: "åŒæ„ã—ã¦ãƒ­ãƒƒã‚¯ã—ã¾ã™",
                cancel: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", confirm: "æ±ºå®š",
                risk_1: "è¨­å®šæ™‚é–“ã¾ã§ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚", risk_2: "å¼·åˆ¶è§£é™¤ã‚’è¡Œã†ã«ã¯è³ªå•ã«ç­”ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                secure_confirm: "ç¾åœ¨æ™‚åˆ»ã‹ã‚‰ç¿Œæœ07:00ã¾ã§å¼·åˆ¶ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚\nè§£é™¤ã§ãã¾ã›ã‚“ãŒã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",
                locked_alert: "ãƒ­ãƒƒã‚¯ä¸­ã¯è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚",
                back: "æˆ»ã‚‹", select_apps_title: "ã‚¢ãƒ—ãƒªã‚’é¸æŠ", confirm_selection: "é¸æŠã‚’ç¢ºå®š",
                app_active: "ãƒ–ãƒ­ãƒƒã‚¯æœ‰åŠ¹",
                premium_history_lock: "å±¥æ­´æ©Ÿèƒ½ã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã§ã™",
                premium_headline: "å‹ã¡é€ƒã’ã“ããŒæœ€å¼·ã®è–æ¯",
                premium_subhead: "ãƒã‚¤ãƒŠã‚¹åç›Šã®å…¨ã¦ã®ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã¸",
                premium_body: "ã€Œã‚ã¨å°‘ã—...ã€ãã®æ¬²ãŒå…¨ã¦ã®åˆ©ç›Šã‚’æº¶ã‹ã—ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ<br>ãƒ—ãƒ­ã¨æ•—è€…ã®å·®ã¯ã€Œå‹ã¡é€ƒã’ã€ãŒã§ãã‚‹ã‹ã€ãŸã ä¸€ç‚¹ã§ã™ã€‚<br>åˆ©ç›Šç¢ºå®šã®ç¬é–“ã«ç›¸å ´ã‹ã‚‰å¼·åˆ¶éš”é›¢ã•ã‚Œã‚‹ã€‚<br>ã“ã®ã€Œå¼·åˆ¶åŠ›ã€ã•ãˆã‚ã‚Œã°ã€è³‡ç”£ã¯ç¢ºå®Ÿã«ç©ã¿ä¸ŠãŒã‚‹å¯èƒ½æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚",
                premium_feature1: "ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚’åˆ¶é™ã—ã€åˆ©ç›ŠãŒæ¸›ã‚‹ã®ã‚’ç‰©ç†çš„ã«é˜²ã",
                premium_feature2: "å¿ƒç†ãƒã‚§ãƒƒã‚¯ã§ãƒã‚¸ãƒã‚¸ç—…ã‚’æŠ‘åˆ¶",
                premium_feature3: "åæ”¯è¨˜éŒ²ãƒãƒ¼ãƒˆã§åˆ†æå¯èƒ½<br>ã‚·ãƒ³ãƒ—ãƒ«ã§ç›´æ„Ÿçš„ã«ä½¿ãˆã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³",
                sub_monthly: "æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³",
                sub_annual: "å¹´é¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³",
                sub_lifetime: "æ°¸ä¹…ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆè²·ã„åˆ‡ã‚Šï¼‰",
                sub_monthly_price: "$9.99 / æœˆ",
                sub_annual_price: "$90.00 / å¹´",
                sub_lifetime_price: "$180.00 / ä¸€æ‹¬",
                feat_secure: "æ„Ÿæƒ…ã‚’æ’é™¤ã™ã‚‹ã€Œç¿Œæœã¾ã§ã®é‰„å£ãƒ­ãƒƒã‚¯ã€",
                feat_gold: "æˆåŠŸè€…ã ã‘ãŒçŸ¥ã‚‹ã€Œé»’ã¨é‡‘ã®æ”¯é…è€…ãƒ†ãƒ¼ãƒã€",
                feat_custom: "ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å…¨æ©Ÿèƒ½ã‚’ä½¿ç”¨å¯èƒ½",
                upgrade_now: "è¿½åŠ æ©Ÿèƒ½ã‚’è³¼å…¥",
                mode_timer: "ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯", mode_secure: "å‹ã¡é€ƒã’ãƒ¢ãƒ¼ãƒ‰",
                execute_lock: "ãƒ­ãƒƒã‚¯å®Ÿè¡Œ",
                unlock_title: "ãƒ­ãƒƒã‚¯å¼·åˆ¶è§£é™¤", pay_unlock_btn: "ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’å—ã‘å…¥ã‚Œã¦è§£é™¤", force_unlock: "å¼·åˆ¶è§£é™¤",
                penalty_desc: "è§£é™¤ãƒšãƒŠãƒ«ãƒ†ã‚£", pt_unit: "pt",
                menu_tutorial: "ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’è¦‹ã‚‹", menu_legal: "åˆ©ç”¨è¦ç´„ãƒ»å…è²¬äº‹é …",
                legal_title: "åˆ©ç”¨è¦ç´„ãƒ»å…è²¬äº‹é …",
                legal_text: `
                    <h4 class="font-bold mb-1">1. å…è²¬äº‹é …</h4>
                    <p class="mb-2 text-sm opacity-80">æœ¬ã‚¢ãƒ—ãƒªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªå·±è¦å¾‹ã‚’è£œåŠ©ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€æŠ•è³„åŠ©è¨€ã‚„åˆ©ç›Šã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <p class="mb-2 text-sm opacity-80">æœ¬ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ï¼ˆãƒ­ãƒƒã‚¯æ©Ÿèƒ½ç­‰ï¼‰ã«ã‚ˆã‚Šã€ç‰¹å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å–å¼•ãŒã§ããšã€æ©Ÿä¼šæå¤±ã‚„é‡‘éŒ¢çš„æå¤±ãŒç™ºç”Ÿã—ãŸå ´åˆã§ã‚‚ã€é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
                    <p class="mb-2 text-sm font-bold text-yellow-400">âš ï¸ æœ¬ã‚¢ãƒ—ãƒªã®ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã¯ã€Œã‚¢ãƒ—ãƒªå†…è¡¨ç¤ºã€ã‚’å‰²ã‚Šå½“ã¦ã‚‹è‡ªå·±è¦å¾‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚iOSã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã§ä»–ã®ã‚¢ãƒ—ãƒªã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹æ©Ÿèƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>

                    <h4 class="font-bold mb-1">2. å¼·åˆ¶è§£é™¤</h4>
                    <p class="mb-2 text-sm opacity-80">ãƒ­ãƒƒã‚¯ä¸­ã®å¼·åˆ¶è§£é™¤ã«ã¯ã€å¿ƒç†çš„è³ªå•ã¸ã®å›ç­”ãŒå¿…è¦ã§ã™ã€‚ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®è‡ªå·±ç®¡ç†ã®ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚</p>

                    <h4 class="font-bold mb-1">3. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</h4>
                    <p class="mb-2 text-sm opacity-80">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã¯è‡ªå‹•æ›´æ–°å‹æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚è§£ç´„ã¯ã€ŒApple ID â†’ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€ã‹ã‚‰ã„ã¤ã§ã‚‚å¯èƒ½ã§ã™ã€‚ç„¡æ–™æœŸé–“ã®çµ‚äº†ã‚’å°‘ãªãã¨ã‚‚ï¼’ï¼”æ™‚é–“å‰ã¾ã§è§£ç´„ã—ãªã„å ´åˆã€æƒ³å®šé‡‘é¡ãŒè«‹æ±‚ã•ã‚Œã¾ã™ã€‚</p>

                    <h4 class="font-bold mb-1">4. å¥åº·ä¸Šã®æ³¨æ„</h4>
                    <p class="mb-2 text-sm opacity-80">éåº¦ãªã‚¹ãƒˆãƒ¬ã‚¹ã‚„ä¾å­˜ã‚’æ„Ÿã˜ã‚‹å ´åˆã¯ã€ç›´ã¡ã«ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚’ä¸­æ­¢ã—ã€å°‚é–€æ©Ÿé–¢ã¸ç›¸è«‡ãã ã•ã„ã€‚</p>
                `,
                tutorial_title: "ã‚ˆã†ã“ãã€Trade Blockã¸",
                tutorial_step1_title: "è¦å¾‹ã‚’å®ˆã‚‹",
                tutorial_step1_desc: "æ„Ÿæƒ…çš„ãªãƒˆãƒ¬ãƒ¼ãƒ‰ã¯è³‡ç”£ã‚’æº¶ã‹ã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒªã¯ã€ç‰©ç†çš„ã«ã‚¢ãƒ—ãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é®æ–­ã—ã€å†·é™ã•ã‚’å–ã‚Šæˆ»ã•ã›ã¾ã™ã€‚",
                tutorial_step2_title: "å‹ã¡é€ƒã’ãƒ¢ãƒ¼ãƒ‰",
                tutorial_step2_desc: "åˆ©ç›ŠãŒå‡ºãŸã‚‰å³åº§ã«ãƒ­ãƒƒã‚¯ã€‚ç¿Œæœã¾ã§å¼·åˆ¶çš„ã«å¸‚å ´ã‹ã‚‰é›¢ã‚Œã‚‹ã“ã¨ã§ã€åˆ©ç›Šã‚’ç¢ºå®Ÿã«ç©ã¿ä¸Šã’ã¾ã™ã€‚",
                tutorial_step3_title: "è‡ªå·±è²¬ä»»",
                tutorial_step3_desc: "ãƒ­ãƒƒã‚¯ä¸­ã¯ä¸€åˆ‡ã®æ“ä½œãŒã§ãã¾ã›ã‚“ã€‚ã“ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ãŸä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚",
                tutorial_step4_title: "ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ è¨±å¯ã®<br>æ‰‹é †",
                tutorial_step4_desc: "ã“ã®å¾Œã€Œã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã€ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚<b>å¿…ãšã€Œé€²ã‚€(ç¶šã‘ã‚‹)ã€ã‚’é¸æŠ</b>ã—ã¦ãã ã•ã„ã€‚<br><span class='text-red-400'>â€»é–“é•ãˆã¦ã€Œè¨±å¯ã—ãªã„ã€ã‚’æŠ¼ã—ãŸå ´åˆï¼š</span><br>iPhoneã®è¨­å®šã‚¢ãƒ—ãƒª &gt; ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ  &gt; ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ ã‹ã‚‰æ‰‹å‹•ã§è¨±å¯ã‚’ã‚ªãƒ³ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                tutorial_step5_title: "ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã‚¢ãƒ—ãƒªã®<br>é¸ã³æ–¹",
                tutorial_step5_desc: "ãƒ­ãƒƒã‚¯ä¸­ã«ä½¿ãˆãªãã—ãŸã„ã‚¢ãƒ—ãƒªã‚’é¸ã³ã¾ã™ã€‚MT4/MT5ã‚„å–å¼•æ‰€ã‚¢ãƒ—ãƒªãªã©ã¯ã€ãƒªã‚¹ãƒˆä¸‹éƒ¨ã®<b>ã€Œæ¤œç´¢ãƒãƒ¼ã€</b>ã‹ã‚‰æ¢ã™ã¨ä¾¿åˆ©ã§ã™ã€‚<br><span class='text-[11px] text-red-400 leading-tight mt-1 block'>â€»è­¦å‘Šï¼šTrade Blockã¯é¸æŠã—ãªã„ã§ãã ã•ã„ã€‚å¼·åˆ¶è§£é™¤ãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</span>",
                tutorial_auth_btn: "ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦å®Œäº†",
                start_btn: "å§‹ã‚ã‚‹",
                menu_privacy: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼",
                menu_restore: "è³¼å…¥ã‚’å¾©å…ƒ",
                menu_manage_sub: "ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†",
                restore_success: "è³¼å…¥ã‚’å¾©å…ƒã—ã¾ã—ãŸ",
                restore_none: "å¾©å…ƒå¯èƒ½ãªè³¼å…¥ã¯ã‚ã‚Šã¾ã›ã‚“",
                privacy_title: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼",
                privacy_text: `
                    <h4 class="font-bold mb-2">1. åé›†ã™ã‚‹æƒ…å ±</h4>
                    <p class="mb-3 text-sm opacity-80">æœ¬ã‚¢ãƒ—ãƒªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã‚’å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ãƒ»åé›†ã—ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆè¨­å®šã€å±¥æ­´ç­‰ï¼‰ã¯ãƒ‡ãƒã‚¤ã‚¹å†…ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
                    <h4 class="font-bold mb-2">2. èª²é‡‘æƒ…å ±</h4>
                    <p class="mb-3 text-sm opacity-80">ã‚¢ãƒ—ãƒªå†…èª²é‡‘ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã¯Appleã®App Storeæ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã‚’é€šã˜ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚é–‹ç™ºè€…ãŒã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚„æ±ºæ¸ˆæƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <h4 class="font-bold mb-2">3. ç¬¬ä¸‰è€…ã¸ã®æä¾›</h4>
                    <p class="mb-3 text-sm opacity-80">æœ¬ã‚¢ãƒ—ãƒªã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«æä¾›ã€è²©å£²ã€å…±æœ‰ã—ã¾ã›ã‚“ã€‚</p>
                    <h4 class="font-bold mb-2">4. ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤</h4>
                    <p class="mb-3 text-sm opacity-80">ã‚¢ãƒ—ãƒªã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€ã™ã¹ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚</p>
                    <h4 class="font-bold mb-2">5. ãŠå•ã„åˆã‚ã›</h4>
                    <p class="mb-3 text-sm opacity-80">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›ã¯ã€App Storeã®ã‚µãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‚ˆã‚Šã”é€£çµ¡ãã ã•ã„ã€‚</p>
                `
            },
            en: {
                tab_home: "TIMER", tab_history: "RECORDS", tab_settings: "SETTINGS", tab_records: "RECORDS",
                lock_btn: "LOCK", secure_profit_btn: "SECURE PROFIT (Until 7AM)",
                time_remain: "Time Remaining",
                history_title: "Force Unlock History", no_history: "No History",
                records_title: "Trade Records", no_records: "No records yet",
                record_add: "Add Record", record_win: "Win", record_loss: "Loss", record_be: "B/E",
                record_pnl: "P&L", record_note: "Note", record_save: "Save",
                record_delete: "Delete", record_confirm_delete: "Delete this record?",
                memo_label: "Lock Memo", memo_placeholder: "Market conditions, goal, reminder...",
                memo_in_unlock: "Your note when you locked",
                settings_title: "Settings", theme: "Theme", blocked_apps: "Blocked Apps", select: "Select",
                premium_title: "Premium Plan",
                secure_subhead: "End today as a winner",
                sub_monthly: "Monthly Subscription ($10)",
                upgrade_cta: "Upgrade to unlock features",
                confirm_title: "Final Check", confirm_desc: "Agree to risks to proceed.",
                chk_risk: "I understand the risks", chk_agree: "I agree to lock",
                cancel: "Cancel", confirm: "Confirm",
                risk_1: "Cannot access apps until timer ends.", risk_2: "You must answer a self-check to force unlock.",
                secure_confirm: "Lock app until 7:00 AM tomorrow?\nThis cannot be undone.",
                locked_alert: "Settings cannot be changed while locked.",
                back: "Back", select_apps_title: "Select Apps", confirm_selection: "Confirm Selection",
                app_active: "Active", save_fee: "Update Fee", fee_saved: "Settings Saved",
                premium_history_lock: "History is Premium Only",
                premium_headline: "The Holy Grail of Trading",
                premium_subhead: "For all traders with negative balance",
                premium_body: "Greed destroys profits. The difference between pros and amateurs is knowing when to stop.<br>Force yourself away from the market after a win.",
                premium_feature1: "Restrict trading and physically prevent profit loss",
                premium_feature2: "Psychological check stops revenge trading impulses",
                premium_feature3: "Income and expense recording feature included. Simple, intuitive design",
                sub_monthly: "Monthly Subscription (7-Day Trial)",
                sub_annual: "Annual Subscription",
                sub_lifetime: "Lifetime License",
                sub_monthly_price: "$9.99 / mo",
                sub_annual_price: "$90.00 / yr",
                sub_lifetime_price: "$180.00 / once",
                feat_secure: "Ironclad Lock until next morning",
                feat_gold: "Exclusive Gold Theme for Winners",
                feat_custom: "Full access to all Trade Block features",
                upgrade_now: "GET DISCIPLINE NOW",
                mode_timer: "Timer Lock", mode_secure: "Secure Profit",
                execute_lock: "EXECUTE LOCK",
                unlock_title: "FORCE UNLOCK", pay_unlock_btn: "ACCEPT PENALTY & UNLOCK", force_unlock: "Force Unlock",
                unlock_q_title: "Before You Unlock", unlock_q_desc: "We do not recommend unlocking if you cannot answer YES to all of the following:",
                unlock_q1: "1. Can you trade strictly following your entry rules?",
                unlock_q2: "2. Are you trying to trade impulsively or for revenge?",
                unlock_q3: "3. Is the current market your anticipated winning pattern?",
                unlock_q4: "4. Are you prepared with proper lot size / risk management?",
                unlock_q5: "5. Are you in a state to calmly accept a loss from this trade?",
                penalty_desc: "Unlock Penalty", pt_unit: "pt",
                menu_tutorial: "Show Tutorial", menu_legal: "Terms & Disclaimer",
                legal_title: "Terms & Disclaimer",
                legal_text: `
                    <h4 class="font-bold mb-1">1. Disclaimer</h4>
                    <p class="mb-2 text-sm opacity-80">This app is a discipline tool and does not guarantee profits. Not financial advice.</p>
                    <p class="mb-2 text-sm opacity-80">The developer is not liable for any losses (financial or opportunity) caused by the inability to trade during a lock.</p>
                    <p class="mb-2 text-sm font-bold text-yellow-400">âš ï¸ The lock feature is an in-app self-discipline screen only. It does NOT block other apps at the iOS system level.</p>

                    <h4 class="font-bold mb-1">2. Force Unlock</h4>
                    <p class="mb-2 text-sm opacity-80">Early unlock requires answering a psychological self-check. This is a self-management feature for the user's own benefit.</p>

                    <h4 class="font-bold mb-1">3. Subscription</h4>
                    <p class="mb-2 text-sm opacity-80">Premium is an auto-renewing monthly subscription. Cancel anytime via Apple ID â†’ Subscriptions. If not cancelled at least 24 hours before the end of the free trial, the subscription price will be charged.</p>

                    <h4 class="font-bold mb-1">4. Health Notice</h4>
                    <p class="mb-2 text-sm opacity-80">If you experience excessive stress or dependency, stop trading immediately and seek professional help.</p>
                `,
                tutorial_title: "Welcome to Trade Block",
                tutorial_step1_title: "Discipline First",
                tutorial_step1_desc: "Emotional trading destroys wealth. Block access to regain cool.",
                tutorial_step2_title: "Secure Profit",
                tutorial_step2_desc: "Lock immediately after a win. Force yourself away until tomorrow.",
                tutorial_step3_title: "Your Responsibility",
                tutorial_step3_desc: "No access during lock. Use with understanding of risks.",
                tutorial_step4_title: "How to Allow Screen Time",
                tutorial_step4_desc: "You will be prompted to allow Screen Time access. <b>Please select 'Continue'.</b><br><span class='text-red-400'>*If you accidentally denied:</span><br>Go to iPhone Settings > Screen Time > Trade Block and turn on access manually.",
                tutorial_step5_title: "How to Select Apps to Block",
                tutorial_step5_desc: "Choose apps you want to block during a lock. Use the <b>Search bar</b> at the bottom to easily find trading apps like MT4/MT5.<br><span class='text-[11px] text-red-400 leading-tight mt-1 block'>*WARNING: Do NOT select Trade Block itself, or you will be permanently locked out.</span>",
                tutorial_auth_btn: "Authorize & Finish",
                start_btn: "Get Started",
                menu_privacy: "Privacy Policy",
                menu_restore: "Restore Purchases",
                menu_manage_sub: "Manage Subscription",
                restore_success: "Purchases restored successfully",
                restore_none: "No purchases to restore",
                privacy_title: "Privacy Policy",
                privacy_text: `
                    <h4 class="font-bold mb-2">1. Information We Collect</h4>
                    <p class="mb-3 text-sm opacity-80">This app does not collect or transmit any personal information to external servers. All data (settings, history, etc.) is stored locally on your device only.</p>
                    <h4 class="font-bold mb-2">2. Payment Information</h4>
                    <p class="mb-3 text-sm opacity-80">In-app purchases (subscriptions) are processed through Apple's App Store payment system. The developer does not access your credit card or payment details.</p>
                    <h4 class="font-bold mb-2">3. Third-Party Sharing</h4>
                    <p class="mb-3 text-sm opacity-80">This app does not share, sell, or provide your personal information to any third parties.</p>
                    <h4 class="font-bold mb-2">4. Data Deletion</h4>
                    <p class="mb-3 text-sm opacity-80">Deleting the app will permanently remove all locally stored data.</p>
                    <h4 class="font-bold mb-2">5. Contact</h4>
                    <p class="mb-3 text-sm opacity-80">For privacy inquiries, please contact us through the App Store support page.</p>
                `
            }
        };

        // Comprehensive translations for ZH, KO, ES
        I18N.zh = {
            tab_home: "ä¸»é¡µ", tab_history: "è®°å½•", tab_settings: "è®¾ç½®", tab_records: "äº¤æ˜“",
            lock_btn: "å¼€å§‹é”å®š", secure_profit_btn: "é”å®šåˆ©æ¶¦ (è‡³æ¬¡æ—¥07:00)",
            time_remain: "å‰©ä½™æ—¶é—´",
            history_title: "å¼ºåˆ¶è§£é™¤è®°å½•", no_history: "æš‚æ— è®°å½•",
            records_title: "äº¤æ˜“è®°å½•", no_records: "æš‚æ— è®°å½•",
            record_add: "æ·»åŠ è®°å½•", record_win: "ç›ˆåˆ©", record_loss: "äºæŸ", record_be: "ä¿æœ¬",
            record_pnl: "ç›ˆäºé‡‘é¢", record_note: "å¤‡æ³¨", record_save: "ä¿å­˜",
            record_delete: "åˆ é™¤", record_confirm_delete: "ç¡®å®šè¦åˆ é™¤æ­¤è®°å½•å—ï¼Ÿ",
            memo_label: "é”å®šå¤‡æ³¨", memo_placeholder: "è¾“å…¥ä¸€å¥è¯...",
            memo_in_unlock: "é”å®šæ—¶çš„å¤‡æ³¨",
            settings_title: "è®¾ç½®", theme: "åº”ç”¨ä¸»é¢˜", blocked_apps: "é˜»æ­¢çš„åº”ç”¨", select: "é€‰æ‹©",
            premium_title: "é«˜çº§ç‰ˆ",
            secure_subhead: "ä»¥ç›ˆåˆ©ç»“æŸä»Šå¤©",
            sub_monthly: "åŒ…æœˆè®¢é˜… (7å¤©å…è´¹è¯•ç”¨)", sub_annual: "åŒ…å¹´è®¢é˜…", sub_lifetime: "ç»ˆèº«ä¹°æ–­",
            sub_monthly_price: "$9.99 / æœˆ", sub_annual_price: "$90.00 / å¹´", sub_lifetime_price: "$180.00 / ä¹°æ–­",
            upgrade_cta: "å‡çº§ä»¥è§£é”æ‰€æœ‰åŠŸèƒ½",
            confirm_title: "é”å®šç¡®è®¤", confirm_desc: "åŒæ„ä»¥ä¸‹é£é™©å¹¶é”å®šã€‚",
            chk_risk: "æˆ‘äº†è§£é£é™©", chk_agree: "åŒæ„å¹¶é”å®š",
            cancel: "å–æ¶ˆ", confirm: "ç¡®å®š",
            risk_1: "åœ¨é”å®šç»“æŸå‰æ— æ³•ä½¿ç”¨åº”ç”¨ã€‚", risk_2: "å¼ºåˆ¶è§£é™¤å¿…é¡»å›ç­”å¿ƒç†æµ‹è¯•ã€‚",
            secure_confirm: "å¼ºåˆ¶é”å®šåˆ°æ¬¡æ—¥07:00ï¼Œæ— æ³•è§£é™¤ã€‚ç¡®è®¤ç»§ç»­å—ï¼Ÿ",
            locked_alert: "é”å®šæœŸé—´æ— æ³•ä¿®æ”¹è®¾ç½®ã€‚",
            back: "è¿”å›", select_apps_title: "é€‰æ‹©åº”ç”¨", confirm_selection: "ç¡®è®¤é€‰æ‹©",
            app_active: "å·²é˜»æ­¢",
            premium_history_lock: "è®°å½•åŠŸèƒ½ä»…é™é«˜çº§ç‰ˆ",
            premium_headline: "ç›ˆåˆ©å‡ºå±€æ‰æ˜¯æœ€å¼ºåœ£æ¯",
            premium_subhead: "è‡´æ‰€æœ‰äºæŸçš„äº¤æ˜“è€…",
            premium_body: "â€œå°±å·®ä¸€ç‚¹ç‚¹â€¦â€¦â€è´ªå©ªæ˜¯å¦æ‘§æ¯äº†ä½ æ‰€æœ‰çš„åˆ©æ¶¦ï¼Ÿ<br>ä¸“ä¸šäººå£«ä¸å¤±è´¥è€…çš„åŒºåˆ«ä»…åœ¨äºçŸ¥é“ä½•æ—¶åœæ­¢ã€‚<br>è·å–åˆ©æ¶¦åå¼ºè¡Œè„±ç¦»å¸‚åœºã€‚<br>æœ‰äº†è¿™å±‚â€œå¼ºåˆ¶åŠ›â€ï¼Œèµ„äº§è‚¯å®šèƒ½å¤Ÿç¨³æ­¥å¢åŠ ã€‚",
            premium_feature1: "é™åˆ¶äº¤æ˜“ï¼Œç‰©ç†çº§é˜²æ­¢åˆ©æ¶¦æµå¤±",
            premium_feature2: "é€šè¿‡å¿ƒç†æµ‹è¯•æŠ‘åˆ¶æŠ¥å¤æ€§äº¤æ˜“",
            premium_feature3: "å†…ç½®æ”¶æ”¯è®°å½•åŠŸèƒ½ï¼Œè®¾è®¡ç®€å•ç›´è§‚",
            feat_secure: "æ„Ÿæƒ…æ’é™¤çš„â€œæ¬¡æ—¥æ¸…æ™¨é“å£é”å®šâ€",
            feat_gold: "ä¸“ä¸ºæˆåŠŸè€…å‡†å¤‡çš„é»‘é‡‘ä¸»é¢˜",
            feat_custom: "å¯ä½¿ç”¨æ‰€æœ‰çš„åŠŸèƒ½",
            upgrade_now: "è´­ä¹°é™„åŠ åŠŸèƒ½",
            mode_timer: "æ™®é€šé”å®š", mode_secure: "åˆ©æ¶¦é”å®š",
            execute_lock: "æ‰§è¡Œé”å®š",
            unlock_title: "å¼ºåˆ¶è§£é™¤", pay_unlock_btn: "æ¥å—æƒ©ç½šå¹¶è§£é™¤", force_unlock: "ç›´æ¥è§£é™¤",
            penalty_desc: "è§£é™¤æƒ©ç½š", pt_unit: "pt",
            menu_tutorial: "æŸ¥çœ‹æ•™ç¨‹", menu_legal: "æœåŠ¡æ¡æ¬¾",
            legal_title: "æœåŠ¡æ¡æ¬¾",
            privacy_title: "éšç§æ”¿ç­–",
            tutorial_title: "æ¬¢è¿ä½¿ç”¨ Trade Block",
            tutorial_step1_title: "çºªå¾‹ç¬¬ä¸€",
            tutorial_step1_desc: "æƒ…ç»ªåŒ–äº¤æ˜“ä¼šæ‘§æ¯è´¢å¯Œã€‚é€šè¿‡é”å®šåº”ç”¨ï¼Œå¸®åŠ©æ‚¨æ¢å¤å†·é™ã€‚",
            tutorial_step2_title: "é”å®šåˆ©æ¶¦",
            tutorial_step2_desc: "è·åˆ©åç«‹å³é”å®šï¼Œå¼ºè¿«è‡ªå·±è¿œç¦»å¸‚åœºç›´è‡³æ˜å¤©ã€‚",
            tutorial_step3_title: "è‡ªæˆ‘è´£ä»»",
            tutorial_step3_desc: "é”å®šæœŸé—´æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œã€‚è¯·åœ¨ç†è§£é£é™©çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚",
            tutorial_step4_title: "å±å¹•ä½¿ç”¨æ—¶é—´æˆæƒ",
            tutorial_step4_desc: "æ¥ä¸‹æ¥å°†è¦æ±‚æ‚¨â€œå…è®¸è®¿é—®å±å¹•ä½¿ç”¨æ—¶é—´â€ã€‚<b>è¯·åŠ¡å¿…é€‰æ‹©â€œç»§ç»­â€</b>ã€‚<br><span class='text-red-400'>â€»å¦‚æœä¸å°å¿ƒç‚¹å‡»äº†ä¸å…è®¸ï¼š</span><br>æ‚¨éœ€è¦å‰å¾€iPhoneçš„ è®¾ç½® > å±å¹•ä½¿ç”¨æ—¶é—´ > Trade Block æ‰‹åŠ¨å¼€å¯æƒé™ã€‚",
            tutorial_step5_title: "å¦‚ä½•é€‰æ‹©è¦é˜»æ­¢çš„åº”ç”¨",
            tutorial_step5_desc: "é€‰æ‹©æ‚¨åœ¨é”å®šæœŸé—´ä¸æƒ³ä½¿ç”¨çš„åº”ç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åˆ—è¡¨åº•éƒ¨çš„<b>â€œæœç´¢æ â€</b>æœç´¢ MT4 ç­‰åç§°ã€‚<br><span class='text-[11px] text-red-400 leading-tight mt-1 block'>â€»è­¦å‘Šï¼šç»å¯¹ä¸è¦é€‰æ‹© Trade Block æœ¬èº«ï¼Œå¦åˆ™å°†å¯¼è‡´æ— æ³•è§£é™¤é”å®šå¹¶æ°¸è¿œè¢«é”å®šåœ¨å¤–ã€‚</span>",
            tutorial_auth_btn: "å…è®¸å¹¶å®Œæˆ",
            start_btn: "å¼€å§‹ä½¿ç”¨", menu_privacy: "éšç§æ”¿ç­–", menu_restore: "æ¢å¤è´­ä¹°", menu_manage_sub: "ç®¡ç†è®¢é˜…",
            restore_success: "è´­ä¹°æ¢å¤æˆåŠŸ", restore_none: "æ²¡æœ‰å¯æ¢å¤çš„è´­ä¹°é¡¹",
            privacy_text: `<h4 class="font-bold mb-2">1. æ•°æ®æ”¶é›†</h4><p class="mb-3 text-sm opacity-80">æœ¬åº”ç”¨ä¸å‘å¤–éƒ¨æœåŠ¡å™¨å‘é€ä»»ä½•ä¸ªäººä¿¡æ¯ã€‚</p>`,
            legal_text: `<h4 class="font-bold mb-1">1. å…è´£å£°æ˜</h4><p class="mb-2 text-sm opacity-80">ä½¿ç”¨æœ¬åº”ç”¨äº§ç”Ÿçš„ä»»ä½•æŸå¤±ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚</p>`
        };

        I18N.ko = {
            tab_home: "íƒ€ì´ë¨¸", tab_history: "ê¸°ë¡", tab_settings: "ì„¤ì •", tab_records: "ê±°ë˜ ê¸°ë¡",
            lock_btn: "ì ê¸ˆ ì‹œì‘", secure_profit_btn: "ìˆ˜ìµ ë³´ì¡´ (ìµì¼ 07:00ê¹Œì§€)",
            time_remain: "ë‚¨ì€ ì‹œê°„",
            history_title: "ê°•ì œ í•´ì œ ê¸°ë¡", no_history: "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤",
            records_title: "ê±°ë˜ ê¸°ë¡", no_records: "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤",
            record_add: "ê¸°ë¡ ì¶”ê°€", record_win: "ìˆ˜ìµ", record_loss: "ì†ì‹¤", record_be: "ë³¸ì ˆ",
            record_pnl: "ì†ìµ ê¸ˆì•¡", record_note: "ë©”ëª¨", record_save: "ì €ì¥",
            record_delete: "ì‚­ì œ", record_confirm_delete: "ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
            memo_label: "ì ê¸ˆ ì‹œ ë©”ëª¨", memo_placeholder: "í•œë§ˆë”” ì…ë ¥...",
            memo_in_unlock: "ì ê¸ˆ ì‹œ ì‘ì„±í•œ ë©”ëª¨",
            settings_title: "ì„¤ì •", theme: "í…Œë§ˆ", blocked_apps: "ì°¨ë‹¨ëœ ì•±", select: "ì„ íƒ",
            premium_title: "í”„ë¦¬ë¯¸ì—„",
            secure_subhead: "ìˆ˜ìµìœ¼ë¡œ ì˜¤ëŠ˜ì„ ë§ˆê°í•˜ì„¸ìš”",
            sub_monthly: "ì›”ê°„ êµ¬ë… (7ì¼ ë¬´ë£Œ ì²´í—˜)", sub_annual: "ì—°ê°„ êµ¬ë…", sub_lifetime: "í‰ìƒ ë¼ì´ì„ ìŠ¤",
            sub_monthly_price: "$9.99 / ì›”", sub_annual_price: "$90.00 / ë…„", sub_lifetime_price: "$180.00 / ì¼ì‹œë¶ˆ",
            upgrade_cta: "ì—…ê·¸ë ˆì´ë“œí•˜ì—¬ ëª¨ë“  ê¸°ëŠ¥ ì ê¸ˆ í•´ì œ",
            confirm_title: "ìµœì¢… í™•ì¸", confirm_desc: "ë‹¤ìŒ ìœ„í—˜ ì‚¬í•­ì— ë™ì˜í•˜ê³  ì ê¸ˆì„ ì‹œì‘í•©ë‹ˆë‹¤.",
            chk_risk: "ìœ„í—˜ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤", chk_agree: "ë™ì˜í•˜ê³  ì ê¸ˆ",
            cancel: "ì·¨ì†Œ", confirm: "í™•ì¸",
            risk_1: "ì ê¸ˆ ì‹œê°„ ë™ì•ˆ ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", risk_2: "ê°•ì œ í•´ì œ ì‹œ ì‹¬ë¦¬ ì§ˆë¬¸ì— ë‹µí•´ì•¼ í•©ë‹ˆë‹¤.",
            secure_confirm: "í˜„ì¬ë¶€í„° ë‚´ì¼ 07:00ê¹Œì§€ ê°•ì œ ì ê¸‰ë‹ˆë‹¤. í•´ì œ ë¶ˆê°€. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
            locked_alert: "ì ê¸ˆ ì¤‘ì—ëŠ” ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
            back: "ë’¤ë¡œ", select_apps_title: "ì•± ì„ íƒ", confirm_selection: "ì„ íƒ ì™„ë£Œ",
            app_active: "ì°¨ë‹¨ í™œì„±í™”ë¨",
            premium_history_lock: "ê¸°ë¡ ê¸°ëŠ¥ì€ í”„ë¦¬ë¯¸ì—„ ì „ìš©ì…ë‹ˆë‹¤",
            premium_headline: "ìˆ˜ìµ ì‹¤í˜„ì´ ìµœê³ ì˜ ì„±ë°°ì…ë‹ˆë‹¤",
            premium_subhead: "ì†ì‹¤ë¡œ ëë‚˜ëŠ” ëª¨ë“  íŠ¸ë ˆì´ë”ë¥¼ ìœ„í•´",
            premium_body: "í”„ë¡œì™€ ì‹¤íŒ¨ìì˜ ì°¨ì´ëŠ” ë©ˆì¶œ ë•Œë¥¼ ì•„ëŠ” ê²ƒë¿ì…ë‹ˆë‹¤.<br>ì´ 'ê°•ì œë ¥'ë§Œ ìˆë‹¤ë©´ ìì‚°ì€ ë°˜ë“œì‹œ ìŒ“ì…ë‹ˆë‹¤.",
            premium_feature1: "ê±°ë˜ë¥¼ ì œí•œí•˜ê³  ì†ì‹¤ì„ ë¬¼ë¦¬ì ìœ¼ë¡œ ë°©ì§€",
            premium_feature2: "ì‹¬ë¦¬ ì²´í¬ë¡œ ê³¼ë§¤ë§¤ ì–µì œ",
            premium_feature3: "ì†ìµ ê¸°ë¡ ê¸°ëŠ¥ íƒ‘ì¬. ì§ê´€ì ì¸ ë””ìì¸",
            feat_secure: "ê°ì •ì„ ë°°ì œí•˜ëŠ” ìµì¼ ì•„ì¹¨ê¹Œì§€ì˜ ì² ë²½ ì ê¸ˆ",
            feat_gold: "ì„±ê³µìë§Œì„ ìœ„í•œ ë¸”ë™ ê³¨ë“œ í…Œë§ˆ",
            feat_custom: "ëª¨ë“  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥",
            upgrade_now: "ì¶”ê°€ ê¸°ëŠ¥ êµ¬ë§¤",
            mode_timer: "íƒ€ì´ë¨¸ ëª¨ë“œ", mode_secure: "ìˆ˜ìµ ë³´ì¡´ ëª¨ë“œ",
            execute_lock: "ì ê¸ˆ ì‹¤í–‰",
            unlock_title: "ê°•ì œ í•´ì œ", pay_unlock_btn: "í˜ë„í‹° ìˆ˜ìš© í›„ í•´ì œ", force_unlock: "ê°•ì œ í•´ì œ",
            penalty_desc: "í•´ì œ í˜ë„í‹°", pt_unit: "pt",
            menu_tutorial: "íŠœí† ë¦¬ì–¼ ë³´ê¸°", menu_legal: "ì´ìš© ì•½ê´€",
            legal_title: "ì´ìš© ì•½ê´€",
            privacy_title: "ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨",
            tutorial_title: "Trade Blockì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤",
            tutorial_step1_title: "ê·œìœ¨ ìš°ì„ ",
            tutorial_step1_desc: "ê°ì •ì ì¸ ê±°ë˜ëŠ” ìì‚°ì„ íŒŒê´´í•©ë‹ˆë‹¤. ì•±ì„ ì°¨ë‹¨í•˜ì—¬ ëƒ‰ì •í•¨ì„ ë˜ì°¾ìœ¼ì„¸ìš”.",
            tutorial_step2_title: "ìˆ˜ìµ ë³´ì¡´",
            tutorial_step2_desc: "ìˆ˜ìµ ë°œìƒ ì‹œ ì¦‰ì‹œ ì ê¸‰ë‹ˆë‹¤. ë‚´ì¼ê¹Œì§€ ì‹œì¥ì—ì„œ ê°•ì œë¡œ ë²—ì–´ë‚˜ì„¸ìš”.",
            tutorial_step3_title: "ìê¸° ì±…ì„",
            tutorial_step3_desc: "ì ê¸ˆ ì¤‘ì—ëŠ” ëª¨ë“  ì¡°ì‘ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ìœ„í—˜ì„ ì´í•´í•˜ê³  ì‚¬ìš©í•˜ì„¸ìš”.",
            tutorial_step4_title: "ìŠ¤í¬ë¦° íƒ€ì„ í—ˆìš© ì ˆì°¨",
            tutorial_step4_desc: "ì´í›„ 'ìŠ¤í¬ë¦° íƒ€ì„ ì ‘ê·¼ í—ˆìš©'ì´ ìš”êµ¬ë©ë‹ˆë‹¤. <b>ë°˜ë“œì‹œ 'ê³„ì†'ì„ ì„ íƒ</b>í•´ ì£¼ì„¸ìš”.<br><span class='text-red-400'>â€»ì‹¤ìˆ˜ë¡œ 'í—ˆìš© ì•ˆ í•¨'ì„ ëˆ„ë¥¸ ê²½ìš°:</span><br>iPhone ì„¤ì • > ìŠ¤í¬ë¦° íƒ€ì„ > Trade Blockì—ì„œ ì§ì ‘ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.",
            tutorial_step5_title: "ì°¨ë‹¨í•  ì•± ì„ íƒ ë°©ë²•",
            tutorial_step5_desc: "ì ê¸ˆ ì¤‘ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ í•  ì•±ì„ ì„ íƒí•©ë‹ˆë‹¤. MT4/MT5 ë“±ì€ ë¦¬ìŠ¤íŠ¸ í•˜ë‹¨ì˜ <b>'ê²€ìƒ‰ì°½'</b>ì„ ì´ìš©í•´ ì°¾ìœ¼ë©´ í¸ë¦¬í•©ë‹ˆë‹¤.<br><span class='text-[11px] text-red-400 leading-tight mt-1 block'>*ê²½ê³ : Trade Block ì•± ìì²´ë¥¼ ì„ íƒí•˜ì§€ ë§ˆì‹­ì‹œì˜¤. ìŠ¤ìŠ¤ë¡œë¥¼ ì ê·¸ì–´ ì˜êµ¬ì ìœ¼ë¡œ í•´ì œí•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.</span>",
            tutorial_auth_btn: "í—ˆìš©í•˜ê³  ì™„ë£Œ",
            start_btn: "ì‹œì‘í•˜ê¸°", menu_privacy: "ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨", menu_restore: "êµ¬ë§¤ ë³µì›", menu_manage_sub: "êµ¬ë… ê´€ë¦¬",
            restore_success: "êµ¬ë§¤ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤", restore_none: "ë³µì›í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤",
            privacy_text: `<h4 class="font-bold mb-2">1. ì •ë³´ ìˆ˜ì§‘</h4><p class="mb-3 text-sm opacity-80">ì´ ì•±ì€ ì–´ë– í•œ ì •ë³´ë„ ì™¸ë¶€ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>`,
            legal_text: `<h4 class="font-bold mb-1">1. ë©´ì±… ì¡°í•­</h4><p class="mb-2 text-sm opacity-80">ì´ ì•±ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ ì†ì‹¤ì€ ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>`
        };

        I18N.es = {
            tab_home: "Temporizador", tab_history: "Historial", tab_settings: "Ajustes", tab_records: "Registros",
            lock_btn: "Iniciar Bloqueo", secure_profit_btn: "Asegurar Ganancia",
            time_remain: "Tiempo Restante",
            history_title: "Historial de Desbloqueo", no_history: "No hay registros",
            records_title: "Diario de Trading", no_records: "No hay registros",
            record_add: "AÃ±adir Registro", record_win: "Ganancia", record_loss: "PÃ©rdida", record_be: "B/E",
            record_pnl: "Monto", record_note: "Nota", record_save: "Guardar",
            record_delete: "Eliminar", record_confirm_delete: "Â¿EstÃ¡s seguro de eliminar esto?",
            memo_label: "Nota al Bloquear", memo_placeholder: "Ingresa una nota breve...",
            memo_in_unlock: "Nota Guardada",
            settings_title: "Ajustes", theme: "Tema", blocked_apps: "Apps Bloqueadas", select: "Seleccionar",
            premium_title: "Plan Premium",
            secure_subhead: "Termina el dÃ­a con ganancias",
            sub_monthly: "SuscripciÃ³n Mensual (7 dÃ­as gratis)", sub_annual: "SuscripciÃ³n Anual", sub_lifetime: "Licencia de por vida",
            sub_monthly_price: "$9.99 / Mes", sub_annual_price: "$90.00 / AÃ±o", sub_lifetime_price: "$180.00 / Ãšnico",
            upgrade_cta: "Mejorar a Premium",
            confirm_title: "ConfirmaciÃ³n Final", confirm_desc: "Acepto los siguientes riesgos al bloquear.",
            chk_risk: "Entiendo los riesgos", chk_agree: "Acepto bloquear",
            cancel: "Cancelar", confirm: "Confirmar",
            risk_1: "No podrÃ¡s acceder a las apps bloqueadas.", risk_2: "El desbloqueo forzado requiere responder preguntas.",
            secure_confirm: "Bloqueo forzado hasta maÃ±ana a las 07:00. No se puede deshacer. Â¿Continuar?",
            locked_alert: "No se pueden cambiar los ajustes durante el bloqueo.",
            back: "Volver", select_apps_title: "Elegir Apps", confirm_selection: "Confirmar SelecciÃ³n",
            app_active: "Activo",
            premium_history_lock: "Historial solo para Premium",
            premium_headline: "Retirarse con ganancias es el Santo Grial",
            premium_subhead: "Para traders con balance negativo",
            premium_body: "La diferencia entre los profesionales y los novatos es saber cuÃ¡ndo parar.<br>AlÃ©jate del mercado despuÃ©s de ganar.",
            premium_feature1: "Restringe el trading para no perder ganancias",
            premium_feature2: "Control psicolÃ³gico contra operar por revancha",
            premium_feature3: "Diario de PnL incorporado de diseÃ±o simple",
            feat_secure: "Bloqueo invencible hasta el dÃ­a siguiente",
            feat_gold: "Tema exclusivo Black & Gold",
            feat_custom: "Todas las funciones activas",
            upgrade_now: "Mejorar Ahora",
            mode_timer: "Temporizador", mode_secure: "Asegurar",
            execute_lock: "Bloquear",
            unlock_title: "Desbloqueo Forzado", pay_unlock_btn: "Aceptar penalizaciÃ³n y desbloquear", force_unlock: "Desbloqueo Forzado",
            penalty_desc: "PenalizaciÃ³n", pt_unit: "pt",
            menu_tutorial: "Ver Tutorial", menu_legal: "TÃ©rminos Legales",
            legal_title: "TÃ©rminos Legales",
            privacy_title: "PolÃ­tica de Privacidad",
            tutorial_title: "Bienvenido a Trade Block",
            tutorial_step1_title: "Disciplina Primero",
            tutorial_step1_desc: "El trading emocional destruye tu riqueza. Reencuentra la calma bloqueando apps.",
            tutorial_step2_title: "Asegurar Ganancia",
            tutorial_step2_desc: "Bloquea justo despuÃ©s de ganar. AlÃ©jate del mercado hasta maÃ±ana.",
            tutorial_step3_title: "Tu Responsabilidad",
            tutorial_step3_desc: "No hay acceso durante el bloqueo. Ãšsalo con plena consciencia de los riesgos.",
            tutorial_step4_title: "Configurar Screen Time",
            tutorial_step4_desc: "Se solicitarÃ¡ permiso para el Tiempo de Uso de Apple. <b>Selecciona 'Continuar'</b>.<br><span class='text-red-400'>*Si denegaste el acceso:</span><br>Ve a Ajustes del iPhone > Tiempo de Uso > Trade Block para activarlo manualmente.",
            tutorial_step5_title: "CÃ³mo Elegir Apps",
            tutorial_step5_desc: "Elige las apps a bloquear. Usa la barra de <b>BÃºsqueda</b> al final de la lista para encontrar MT4/MT5 rÃ¡pido.<br><span class='text-[11px] text-red-400 leading-tight mt-1 block'>*ADVERTENCIA: NO selecciones el propio Trade Block, o quedarÃ¡s bloqueado permanentemente.</span>",
            tutorial_auth_btn: "Autorizar y Finalizar",
            start_btn: "Empezar", menu_privacy: "Privacidad", menu_restore: "Restaurar Compra", menu_manage_sub: "Gestionar SuscripciÃ³n",
            restore_success: "Compras restauradas con Ã©xito", restore_none: "No hay compras que restaurar",
            privacy_text: `<h4 class="font-bold mb-2">1. Privacidad</h4><p class="mb-3 text-sm opacity-80">La app no envÃ­a datos a servidores externos.</p>`,
            legal_text: `<h4 class="font-bold mb-1">1. Descargo de Responsabilidad</h4><p class="mb-2 text-sm opacity-80">Las pÃ©rdidas son responsabilidad exclusiva del usuario.</p>`
        };

        class TradeGuardApp {
            constructor() {
                this.state = {
                    lang: 'ja', tab: 'home', page: 'main', homeMode: 'timer',
                    isPremium: false, isLocked: false, lockEndTime: null,
                    fee: CONSTANTS.DEFAULT_FEE, duration: 60, theme: 'light',
                    history: [], hasSeenTutorial: false, memo: '',
                    blockedApps: ['MetaTrader 4', 'MetaTrader 5', 'TradingView']
                };
                this.timerInterval = null;
                this.chartInterval = null;
                this.candles = [];
                this.init();
            }

            init() {
                try {
                    const saved = localStorage.getItem('tradeblock_v5');
                    if (saved) {
                        let parsed = JSON.parse(saved);
                        if (!parsed.v6_theme_reset) {
                            parsed.theme = 'light';
                            parsed.v6_theme_reset = true;
                        }
                        this.state = { ...this.state, ...parsed };
                    } else {
                        this.state.v6_theme_reset = true;
                    }
                } catch (e) { console.error(e); }

                if (this.state.isLocked && Date.now() > this.state.lockEndTime) {
                    this.unlock(true);
                }

                this.applyTheme(this.state.theme);
                this.setLang(this.state.lang);

                // --- HARD PAYWALL ENFORCEMENT ---
                if (!this.state.isPremium) {
                    this.state.page = 'paywall';
                    this.state.tab = 'home'; // hide other content just in case
                }

                this.startTimer();
                this.initChart();

                if (this.state.isPremium && !this.state.hasSeenTutorial) {
                    this.showTutorial();
                }
                this.render();
            }

            save() { localStorage.setItem('tradeblock_v5', JSON.stringify(this.state)); }

            resetData() {
                if (confirm("DEBUG: Reset all data?")) {
                    localStorage.clear(); location.reload();
                }
            }

            async requestScreenTimeAuth() {
                if (window.Capacitor && Capacitor.Plugins.ScreenTime) {
                    try {
                        const result = await Capacitor.Plugins.ScreenTime.requestAuthorization();
                        if (!result.authorized) {
                            console.warn('Screen Time authorization denied');
                        }
                    } catch (e) { console.error('Screen Time auth error:', e); }
                }
            }

            async openNativeAppPicker() {
                if (window.Capacitor && Capacitor.Plugins.ScreenTime) {
                    try {
                        await Capacitor.Plugins.ScreenTime.showAppPicker();
                    } catch (e) {
                        console.error(e);
                        alert("NATIVE ERROR: " + (e.message || JSON.stringify(e)) + "\n\n(Did you add the .m files to the Xcode target?)");
                        this.setPage('apps');
                    }
                } else {
                    alert("PLUGIN NOT FOUND. Capacitor.Plugins.ScreenTime is missing.");
                    this.setPage('apps');
                }
            }

            t(key) { return I18N[this.state.lang][key] || key; }

            startTimer() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                this.timerInterval = setInterval(() => {
                    if (this.state.isLocked) {
                        const now = Date.now();
                        const diff = this.state.lockEndTime - now;
                        if (diff <= 0) this.unlock();
                        else this.updateTimerUI(diff);
                    }
                }, 1000);
            }

            unlock(silent = false) {
                this.state.isLocked = false;
                this.state.lockEndTime = null;
                this.save();
                // Unblock apps via Screen Time
                if (window.Capacitor && Capacitor.Plugins.ScreenTime) {
                    Capacitor.Plugins.ScreenTime.unblockApps();
                }
                this.render();
                if (!silent) alert(this.state.lang === 'ja' ? (this._forceUnlocked ? 'ãƒ­ãƒƒã‚¯ã‚’å¼·åˆ¶è§£é™¤ã—ã¾ã—ãŸ' : 'æ™‚é–“çµŒéã«ã‚ˆã‚Šè§£é™¤ã•ã‚Œã¾ã—ãŸ') : (this._forceUnlocked ? 'Force unlock complete.' : 'UNLOCKED'));
            }

            applyTheme(theme) {
                const root = document.documentElement;
                root.className = '';
                if (theme === 'dark') root.classList.add('dark');
                if (theme === 'gold') root.classList.add('theme-gold');
            }

            setLang(lang) {
                this.state.lang = lang;
                // Currently zh, ko, es fall back to English for some dynamic data if not fully loaded, 
                // but we will use 'en' rules for the fee currency ($, amounts)
                const isJPY = (lang === 'ja');
                if (!isJPY) {
                    if (this.state.fee >= 100) this.state.fee = Math.max(5, Math.floor(this.state.fee / 100));
                } else {
                    if (this.state.fee < 100) this.state.fee = Math.max(500, this.state.fee * 100);
                }
                this.save();
                this.render();
            }

            setHomeMode(mode) { this.state.homeMode = mode; this.render(); }
            setTab(tab) { this.state.tab = tab; this.state.page = 'main'; this.save(); this.render(); }
            setPage(page) { this.state.page = page; this.render(); }

            toggleTheme(theme) {
                if (theme === 'gold' && !this.state.isPremium) {
                    this.showPremiumModal(); return;
                }
                this.state.theme = theme;
                this.applyTheme(theme);
                this.save();
                this.render();
            }

            updateFeeDisplay(val) {
                const el = document.getElementById('fee-display');
                if (el) {
                    const cur = this.state.lang === 'ja' ? 'Â¥' : '$';
                    el.innerText = cur + parseInt(val).toLocaleString();
                }
            }

            saveFee() {
                const slider = document.getElementById('fee-slider');
                if (slider) {
                    this.state.fee = parseInt(slider.value);
                    this.save(); alert(this.t('fee_saved')); this.render();
                }
            }

            initChart() {
                const canvas = document.getElementById('bg-canvas');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                let width, height;
                const resize = () => {
                    width = canvas.parentElement.offsetWidth;
                    height = canvas.parentElement.offsetHeight * 0.7;
                    canvas.width = width; canvas.height = height;
                };
                window.addEventListener('resize', resize); resize();
                this.candles = [];
                let price = 100;
                for (let i = 0; i < 30; i++) {
                    const move = (Math.random() - 0.5) * 5;
                    this.candles.push({ open: price, close: price + move, high: price + Math.abs(move) + 1, low: price - Math.abs(move) - 1 });
                    price += move;
                }
                let lastCandleTime = Date.now();
                let currentCandle = { ...this.candles[this.candles.length - 1] };
                const tick = () => {
                    const now = Date.now();
                    if (now - lastCandleTime >= 3000) {
                        this.candles.push(currentCandle);
                        if (this.candles.length > 40) this.candles.shift();
                        lastCandleTime = now;
                        const start = currentCandle.close;
                        currentCandle = { open: start, close: start, high: start, low: start };
                    }
                    const change = (Math.random() - 0.5) * 0.5;
                    currentCandle.close += change;
                    if (currentCandle.close > currentCandle.high) currentCandle.high = currentCandle.close;
                    if (currentCandle.close < currentCandle.low) currentCandle.low = currentCandle.close;
                    this.drawChart(ctx, width, height, [...this.candles, currentCandle]);
                    requestAnimationFrame(tick);
                };
                tick();
            }

            drawChart(ctx, w, h, data) {
                ctx.clearRect(0, 0, w, h);
                let min = Infinity, max = -Infinity;
                data.forEach(c => { if (c.low < min) min = c.low; if (c.high > max) max = c.high; });
                const range = max - min || 1;
                const gap = 6;
                const candleW = (w - (data.length * gap)) / data.length;
                const isGold = this.state.theme === 'gold';
                const upColor = isGold ? '#D4AF37' : '#10B981';
                const downColor = isGold ? '#78350F' : '#EF4444';
                data.forEach((c, i) => {
                    const x = i * (candleW + gap);
                    const yOpen = h - ((c.open - min) / range) * h * 0.8 - (h * 0.1);
                    const yClose = h - ((c.close - min) / range) * h * 0.8 - (h * 0.1);
                    const yHigh = h - ((c.high - min) / range) * h * 0.8 - (h * 0.1);
                    const yLow = h - ((c.low - min) / range) * h * 0.8 - (h * 0.1);
                    const color = c.close >= c.open ? upColor : downColor;
                    ctx.strokeStyle = color; ctx.lineWidth = 1;
                    ctx.beginPath(); ctx.moveTo(x + candleW / 2, yHigh); ctx.lineTo(x + candleW / 2, yLow); ctx.stroke();
                    ctx.fillStyle = color;
                    ctx.fillRect(x, Math.min(yOpen, yClose), candleW, Math.max(1, Math.abs(yClose - yOpen)));
                });
            }

            setTab(tab) {
                if (!this.state.isPremium) return; // Block navigation if not premium

                this.state.tab = tab;
                this.state.page = 'main';
                this.save();
                this.render();
            }

            render() {
                const isPaywall = this.state.page === 'paywall';

                // Toggle app shell visibility
                const header = document.querySelector('header');
                const nav = document.querySelector('nav');
                const canvas = document.getElementById('bg-canvas');

                if (header) header.style.display = isPaywall ? 'none' : 'flex';
                if (nav) nav.style.display = isPaywall ? 'none' : 'flex';
                if (canvas) canvas.style.display = isPaywall ? 'none' : 'block';

                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const isActive = btn.dataset.tab === this.state.tab;
                    Object.assign(btn.style, {
                        opacity: (isActive && !isPaywall) ? '1' : '0.4',
                        pointerEvents: isPaywall ? 'none' : 'auto'
                    });

                    if (isActive && !isPaywall) btn.classList.add('text-[var(--primary)]');
                    else btn.classList.remove('text-[var(--primary)]');
                    btn.querySelector('span:last-child').innerText = this.t('tab_' + btn.dataset.tab);
                });
                const main = document.getElementById('main-content');
                main.innerHTML = '';

                // If paywall, remove main padding so it fills screen
                if (isPaywall) {
                    main.className = "relative z-10 flex-1 overflow-y-auto no-scrollbar bg-black fixed inset-0 w-full h-full";
                    main.appendChild(this.renderPaywall());
                } else {
                    main.className = "relative z-10 flex-1 overflow-y-auto no-scrollbar p-6 pt-0 pb-32";
                    if (this.state.page === 'apps') main.appendChild(this.renderAppsPage());
                    else if (this.state.tab === 'home') main.appendChild(this.renderHome());
                    else if (this.state.tab === 'records') main.appendChild(this.renderRecords());
                    else if (this.state.tab === 'settings') main.appendChild(this.renderSettings());
                }
            }

            renderHome() {
                const div = document.createElement('div');
                div.className = "flex flex-col h-full justify-start pb-4 space-y-4 fade-in pt-2";
                if (!this.state.isLocked) {
                    div.innerHTML += `
                        <div class="flex p-1 bg-[var(--card-bg)] rounded-xl border border-[var(--border)] mx-2 mb-2 shadow-sm">
                            <button onclick="app.setHomeMode('timer')" class="flex-1 py-2 text-sm font-bold rounded-lg transition ${this.state.homeMode === 'timer' ? 'bg-[var(--text-color)] text-[var(--bg-color)] shadow-md' : 'opacity-60'}">â± ${this.t('mode_timer')}</button>
                            <button onclick="app.setHomeMode('secure')" class="flex-1 py-2 text-sm font-bold rounded-lg transition ${this.state.homeMode === 'secure' ? 'bg-gradient-to-r from-amber-400 to-amber-600 text-white shadow-md' : 'opacity-60'}">ğŸ† ${this.t('mode_secure')}</button>
                        </div>
                    `;
                }
                if (this.state.homeMode === 'secure' && !this.state.isLocked) {
                    div.innerHTML += `
                        <div class="flex-1 flex flex-col items-center justify-center text-center px-4 space-y-6">
                            <div class="w-40 h-40 rounded-full bg-gradient-to-br from-amber-300 to-amber-600 flex items-center justify-center shadow-2xl animate-pulse"><span class="text-6xl">ğŸ†</span></div>
                            <div><h2 class="text-2xl font-black mb-2 text-[var(--accent-gold)]">${this.t('secure_profit_btn')}</h2><p class="font-bold opacity-70 text-sm leading-relaxed">${this.t('secure_subhead')}</p></div>
                            ${this.state.isPremium ? `<button onclick="app.triggerSecureProfit()" class="btn btn-gold w-full text-xl py-6 shadow-2xl border-2 border-white/20">${this.t('execute_lock')}</button>` : `<div class="bg-[var(--card-bg)] p-6 rounded-2xl border border-[var(--border)] w-full shadow-lg"><p class="text-sm font-bold opacity-60 mb-4">PREMIUM ONLY</p><button onclick="app.showPremiumModal()" class="btn btn-primary w-full shadow-xl">${this.t('upgrade_cta')}</button></div>`}
                        </div>
                    `;
                    return div;
                }
                div.innerHTML += `
                    <div class="flex-1 flex flex-col items-center justify-center relative min-h-[280px]">
                        <div class="relative w-72 h-72 flex items-center justify-center">
                            <svg class="w-full h-full transform -rotate-90"><circle cx="144" cy="144" r="130" stroke="var(--border)" stroke-width="12" fill="none" opacity="0.1"></circle><circle id="timer-circle" cx="144" cy="144" r="130" stroke="${this.state.isLocked ? 'var(--danger)' : 'var(--primary)'}" stroke-width="12" fill="none" stroke-dasharray="816" stroke-dashoffset="0"></circle></svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center"><span id="timer-text" class="text-5xl font-black tabular-nums">${this.state.isLocked ? "--:--" : this.formatDuration(this.state.duration)}</span><span class="text-sm font-bold opacity-60 mt-2 tracking-widest">${this.t('time_remain')}</span></div>
                        </div>
                    </div>
                    ${!this.state.isLocked ? `
                        <div class="bg-[var(--card-bg)]/80 backdrop-blur rounded-2xl p-6 border border-[var(--border)] shadow-lg mx-2"><input type="range" min="5" max="1440" step="5" value="${this.state.duration}" oninput="app.setDuration(this.value)" class="w-full"><div class="flex justify-between text-xs font-bold opacity-60 mt-2 px-1"><span>5m</span><span>24h</span></div></div>
                        <div class="px-2 pb-4"><button onclick="app.showLockConfirm()" class="btn btn-primary shadow-xl text-xl py-5">ğŸ”’ ${this.t('lock_btn')}</button></div>
                    ` : `
                        <div class="px-2 space-y-4 pb-4">
                            <div class="p-4 bg-red-500/10 border border-red-500 rounded-xl text-center"><p class="text-red-500 font-bold text-lg animate-pulse">LOCKED</p></div>
                            ${this.state.memo ? `<div class="p-3 bg-[var(--card-bg)] border border-[var(--border)] rounded-xl"><p class="text-xs font-bold opacity-50 mb-1">ğŸ“ ${this.t('memo_label')}</p><p class="text-sm font-bold leading-relaxed">${this.state.memo.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p><button onclick="app.editMemo()" class="text-xs opacity-40 mt-1 font-bold">${this.state.lang === 'ja' ? 'ç·¨é›†' : 'Edit'}</button></div>` : `<button onclick="app.editMemo()" class="w-full py-3 border border-dashed border-[var(--border)] rounded-xl text-sm font-bold opacity-50">ğŸ“ ${this.state.lang === 'ja' ? 'ãƒ¡ãƒ¢ã‚’è¿½åŠ ' : 'Add Memo'}</button>`}
                            <button onclick="app.showPaymentModal()" class="btn bg-gray-800 text-white shadow-xl py-5 text-xl">ğŸ”“ ${this.t('force_unlock')}</button>
                        </div>
                    `}
                `;
                return div;
            }

            renderHistory() {
                const div = document.createElement('div');
                div.className = "space-y-4 fade-in pt-6";
                const ja = this.state.lang === 'ja';
                if (!this.state.isPremium) {
                    div.innerHTML = `<h2 class="text-3xl font-bold px-2 mb-4">${this.t('history_title')}</h2><div class="card p-8 text-center flex flex-col items-center justify-center gap-4 border-2 border-[var(--accent-gold)] border-dashed bg-black/5"><span class="text-5xl">ğŸ”’</span><p class="font-bold text-lg opacity-80">${this.t('premium_history_lock')}</p><button onclick="app.showPremiumModal()" class="btn btn-primary mt-4 py-4 px-8 shadow-xl">${this.t('upgrade_cta')}</button></div>`;
                    return div;
                }
                div.innerHTML = `<div class="flex justify-between items-end px-2 mb-2"><h2 class="text-3xl font-bold">${this.t('history_title')}</h2></div><div class="space-y-3">${this.state.history.length === 0 ? `<p class="text-center opacity-50 py-10 font-bold text-xl">${this.t('no_history')}</p>` : ''}${this.state.history.map(item => {
                    const label = item.type === 'force_unlock'
                        ? `<span class="text-sm font-black text-[var(--danger)] bg-red-500/10 px-3 py-1 rounded-full">âš ï¸ ${ja ? 'å¼·åˆ¶è§£é™¤' : 'Force Unlock'}</span>`
                        : `<span class="text-sm font-bold opacity-60">${item.amount !== undefined ? item.amount + ' pt' : '-'}</span>`;
                    return `<div class="card flex justify-between items-center py-4 px-6"><span class="font-bold text-sm opacity-60">${item.date}</span>${label}</div>`;
                }).join('')}</div>`;
                return div;
            }

            renderRecords() {
                const div = document.createElement('div');
                div.className = 'fade-in pb-28';
                const ja = this.state.lang === 'ja';
                let records = [];
                try { records = JSON.parse(localStorage.getItem(CONSTANTS.RECORDS_KEY) || '[]'); } catch (e) { }

                const now = new Date();
                if (!this._calYear) { this._calYear = now.getFullYear(); this._calMonth = now.getMonth(); }
                if (this._selectedDay === undefined) this._selectedDay = now.getDate();
                const year = this._calYear, month = this._calMonth, selDay = this._selectedDay;

                const mNamesJa = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                const mNamesEn = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const monthLabel = ja ? `${year}å¹´ ${mNamesJa[month]}` : `${mNamesEn[month]} ${year}`;
                const dayLabels = ja ? ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'] : ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                const cur = ja ? 'Â¥' : '$';

                const dayMap = {};
                let monthPnl = 0;
                records.filter(r => r.year === year && r.month === month).forEach(r => {
                    if (!dayMap[r.day]) dayMap[r.day] = [];
                    dayMap[r.day].push(r);
                    monthPnl += (r.pnl || 0);
                });

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Build header rows
                let grid = dayLabels.map((d, i) => {
                    const col = i === 0 ? 'text-red-400' : i === 6 ? 'text-blue-400' : 'opacity-40';
                    return `<div class="text-center text-xs font-black ${col} pb-2">${d}</div>`;
                }).join('');
                for (let i = 0; i < firstDay; i++) grid += `<div></div>`;

                for (let d = 1; d <= daysInMonth; d++) {
                    const isToday = (d === now.getDate() && month === now.getMonth() && year === now.getFullYear());
                    const isSel = d === selDay;
                    const dayRecs = dayMap[d] || [];
                    const dayPnl = dayRecs.reduce((s, r) => s + (r.pnl || 0), 0);
                    const hasPnl = dayRecs.length > 0;
                    const amtColor = dayPnl > 0 ? 'text-emerald-500' : dayPnl < 0 ? 'text-red-500' : 'opacity-40';
                    const circleClass = isSel
                        ? 'day-circle w-8 h-8 rounded-full bg-[var(--accent-gold)] text-white flex items-center justify-center'
                        : isToday
                            ? 'day-circle w-8 h-8 rounded-full ring-2 ring-[var(--primary)] flex items-center justify-center'
                            : 'day-circle w-8 h-8 flex items-center justify-center';
                    grid += `<div id="cal-day-${d}" data-istoday="${isToday ? '1' : '0'}" onclick="app.selectDay(${d})" class="flex flex-col items-center py-1 cursor-pointer active:scale-95 transition-all">
                        <div class="${circleClass}"><span class="text-sm font-black">${d}</span></div>
                        ${hasPnl ? `<span class="text-[9px] font-black ${amtColor} leading-tight mt-0.5">${dayPnl >= 0 ? '+' : ''}${dayPnl.toLocaleString()}</span>` : '<span class="text-[9px] opacity-0">-</span>'}
                    </div>`;
                }

                // Selected day records panel
                const selRecs = dayMap[selDay] || [];
                const selPnl = selRecs.reduce((s, r) => s + (r.pnl || 0), 0);
                const selPnlColor = selPnl > 0 ? 'text-emerald-500' : selPnl < 0 ? 'text-red-500' : 'opacity-60';
                const selDateLabel = ja ? `${year}å¹´${month + 1}æœˆ${selDay}æ—¥` : `${mNamesEn[month]} ${selDay}, ${year}`;
                const pnlColor = monthPnl > 0 ? 'text-emerald-500' : monthPnl < 0 ? 'text-red-500' : 'opacity-60';

                let recRows = '';
                if (selRecs.length === 0) {
                    recRows = `<p class="text-center opacity-40 font-bold py-5 text-sm">${this.t('no_records')}</p>`;
                } else {
                    recRows = selRecs.map(r => {
                        const pnl = r.pnl || 0;
                        const col = pnl > 0 ? 'text-emerald-500' : pnl < 0 ? 'text-red-500' : 'opacity-60';
                        const sign = pnl >= 0 ? '+' : '-';
                        return `<div class="flex justify-between items-center py-3 border-b border-[var(--border)] last:border-0">
                            <div class="flex flex-col">
                                <span class="font-black text-base ${col}">${sign}${cur}${Math.abs(pnl).toLocaleString()}</span>
                                ${r.note ? `<span class="text-xs opacity-50 mt-0.5">${r.note.replace(/</g, '&lt;')}</span>` : ''}
                            </div>
                            <button onclick="app.deleteRecord(${r.id})" class="text-xs opacity-30 active:opacity-80 font-bold px-2 py-1">Ã—</button>
                        </div>`;
                    }).join('');
                }

                div.innerHTML = `
                    <!-- Month nav + P&L -->
                    <div class="flex items-center justify-between px-4 py-3 bg-[var(--card-bg)] border-b border-[var(--border)]">
                        <button onclick="app.calNav(-1)" class="w-9 h-9 rounded-full border border-[var(--border)] font-black text-lg flex items-center justify-center bg-[var(--bg-color)]">â€¹</button>
                        <div class="text-center">
                            <div class="relative inline-flex items-center justify-center cursor-pointer">
                                <p class="font-black text-xl flex items-center gap-1">
                                    <span>${monthLabel}</span>
                                    <span class="text-[10px] opacity-60">â–¼</span>
                                </p>
                                <input type="month" class="absolute inset-0 opacity-0 w-full h-full cursor-pointer" value="${year}-${String(month + 1).padStart(2, '0')}" onchange="app.jumpToYearMonth(this.value)">
                            </div>
                            <p class="text-2xl font-black ${pnlColor}">${monthPnl > 0 ? '+' : monthPnl < 0 ? '-' : ''}${cur}${Math.abs(monthPnl).toLocaleString()}</p>
                        </div>
                        <button onclick="app.calNav(1)" class="w-9 h-9 rounded-full border border-[var(--border)] font-black text-lg flex items-center justify-center bg-[var(--bg-color)]">â€º</button>
                    </div>
                    <!-- Calendar -->
                    <div class="bg-[var(--card-bg)] px-3 pb-3">
                        <div class="grid grid-cols-7 gap-y-1">${grid}</div>
                    </div>
                    <!-- Add button â€” fixed below calendar, above records -->
                    <div class="bg-[var(--bg-color)] px-4 pt-3 pb-2">
                        <button id="add-rec-btn" onclick="app.showAddRecord(${year},${month},${selDay})" class="w-full py-3 rounded-xl bg-[var(--accent-gold)] text-white font-black text-base shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2"><span class="text-xl">+</span> ${this.t('record_add')}</button>
                    </div>
                    <!-- Selected day panel -->
                    <!-- Selected day panel -->
                    <div id="sel-day-panel" class="bg-[var(--bg-color)] px-4 pt-0">
                        ${this._buildSelDayHTML()}
                    </div>
                    <!-- no floating FAB -->
                `;
                return div;
            }

            calNav(dir) {
                // Fix: `_calMonth` can be 0 (January), which is falsy â€” use explicit null check
                if (this._calYear == null) { const n = new Date(); this._calYear = n.getFullYear(); this._calMonth = n.getMonth(); }
                this._calMonth += dir;
                if (this._calMonth > 11) { this._calMonth = 0; this._calYear++; }
                if (this._calMonth < 0) { this._calMonth = 11; this._calYear--; }
                this._selectedDay = undefined; // reset selected day on month change
                this.render();
            }

            jumpToYearMonth(val) {
                if (!val) return;
                const [y, m] = val.split('-');
                this._calYear = parseInt(y, 10);
                this._calMonth = parseInt(m, 10) - 1;
                this._selectedDay = undefined;
                this.render();
            }

            selectDay(d) {
                const prev = this._selectedDay;
                this._selectedDay = d;

                // Remove gold from previous cell
                if (prev != null && prev !== d) {
                    const prevEl = document.getElementById('cal-day-' + prev);
                    if (prevEl) {
                        const circle = prevEl.querySelector('.day-circle');
                        if (circle) {
                            const isToday = prevEl.dataset.istoday === '1';
                            circle.className = isToday
                                ? 'day-circle w-8 h-8 rounded-full ring-2 ring-[var(--primary)] flex items-center justify-center'
                                : 'day-circle w-8 h-8 flex items-center justify-center';
                        }
                    }
                }
                // Apply gold to new cell
                const newEl = document.getElementById('cal-day-' + d);
                if (newEl) {
                    const circle = newEl.querySelector('.day-circle');
                    if (circle) circle.className = 'day-circle w-8 h-8 rounded-full bg-[var(--accent-gold)] text-white flex items-center justify-center';
                }
                // Update the day records panel in-place
                const panel = document.getElementById('sel-day-panel');
                if (panel) {
                    panel.innerHTML = this._buildSelDayHTML();
                } else {
                    this.render(); // fallback
                }
                // CRITICAL: update the add-record button so it targets the newly selected day
                const addBtn = document.getElementById('add-rec-btn');
                if (addBtn) addBtn.setAttribute('onclick', `app.showAddRecord(${this._calYear},${this._calMonth},${d})`);
            }

            _buildSelDayHTML() {
                const ja = this.state.lang === 'ja';
                const cur = ja ? 'Â¥' : '$';
                const mNamesEn = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                let records = [];
                try { records = JSON.parse(localStorage.getItem(CONSTANTS.RECORDS_KEY) || '[]'); } catch (e) { }
                const year = this._calYear, month = this._calMonth, selDay = this._selectedDay;
                const selRecs = records.filter(r => r.year === year && r.month === month && r.day === selDay);

                const selPnl = selRecs.reduce((s, r) => s + (r.pnl || 0), 0);
                const selPnlColor = selPnl > 0 ? 'text-emerald-500' : selPnl < 0 ? 'text-red-500' : 'opacity-60';
                const selDateLabel = ja ? `${year}å¹´${month + 1}æœˆ${selDay}æ—¥` : `${mNamesEn[month]} ${selDay}, ${year}`;
                let recRows = '';
                if (selRecs.length === 0) {
                    recRows = `<p class="text-center opacity-40 font-bold py-5 text-sm">${this.t('no_records')}</p>`;
                } else {
                    recRows = selRecs.map(r => {
                        const pnl = r.pnl || 0;
                        const col = pnl > 0 ? 'text-emerald-500' : pnl < 0 ? 'text-red-500' : 'opacity-60';
                        const sign = pnl >= 0 ? '+' : '-';
                        return `<div class="flex justify-between items-center py-3 border-b border-[var(--border)] last:border-0">
                            <div class="flex flex-col">
                                <span class="font-black text-base ${col}">${sign}${cur}${Math.abs(pnl).toLocaleString()}</span>
                                ${r.note ? `<span class="text-xs opacity-50 mt-0.5">${r.note.replace(/</g, '&lt;')}</span>` : ''}
                            </div>
                            <button onclick="app.deleteRecord(${r.id})" class="text-xs opacity-30 active:opacity-80 font-bold px-3 py-2">Ã—</button>
                        </div>`;
                    }).join('');
                }
                return `
                    <div class="flex justify-between items-end mb-3 mt-4">
                        <span class="font-black text-base leading-none">${selDateLabel}</span>
                        <div class="flex flex-col items-end gap-2">
                            <span class="font-black text-base leading-none ${selPnlColor}">${selRecs.length > 0 ? (selPnl >= 0 ? '+' : '-') + cur + Math.abs(selPnl).toLocaleString() : cur + '0'}</span>
                            ${selRecs.length > 0 ? `<button onclick="app.deleteAllRecords(${year},${month},${selDay})" class="text-[10px] font-black tracking-widest text-[#EF4444] border border-[#EF4444]/30 bg-[#EF4444]/10 rounded px-2 py-1 mt-1 active:opacity-60 transition-colors uppercase">${ja ? 'å…¨å‰Šé™¤' : 'Clear All'}</button>` : ''}
                        </div>
                    </div>
                    <div class="bg-[var(--card-bg)] rounded-2xl px-4 py-1 border border-[var(--border)] shadow-sm">${recRows}</div>
                `;
            }

            showAddRecord(year, month, day) {
                const ja = this.state.lang === 'ja';
                const cur = ja ? 'Â¥' : '$';
                const mNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const dateLabel = ja ? `${year}å¹´${month + 1}æœˆ${day}æ—¥` : `${mNames[month]} ${day}, ${year}`;
                this._recSign = 1; // default: profit
                this.showModal(`
                    <h3 class="text-xl font-black mb-1">${this.t('record_add')}</h3>
                    <p class="text-xs opacity-50 font-bold mb-4">${dateLabel}</p>
                    <div class="space-y-3">
                        <div class="flex rounded-xl overflow-hidden border border-[var(--border)]">
                            <button id="sign-plus" onclick="app._setSign(1)" class="flex-1 py-3 font-black text-sm bg-emerald-500 text-white transition">${ja ? 'åˆ©ç›Š (+)' : 'Profit (+)'}</button>
                            <button id="sign-minus" onclick="app._setSign(-1)" class="flex-1 py-3 font-black text-sm bg-[var(--bg-color)] text-red-400 transition">${ja ? 'æå¤± (âˆ’)' : 'Loss (âˆ’)'}</button>
                        </div>
                        <div>
                            <label class="text-xs font-black opacity-60 block mb-1">${this.t('record_pnl')} (${cur})</label>
                            <input id="rec-pnl" type="number" min="0" placeholder="10000" class="w-full p-3 rounded-xl border border-[var(--border)] bg-[var(--bg-color)] font-bold text-base focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">
                        </div>
                        <div>
                            <label class="text-xs font-black opacity-60 block mb-1">${this.t('record_note')}</label>
                            <input id="rec-note" type="text" placeholder="${ja ? 'ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰' : 'Note (optional)'}" class="w-full p-3 rounded-xl border border-[var(--border)] bg-[var(--bg-color)] font-bold text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button onclick="app.closeModal();app.render();" class="flex-1 py-3 font-bold opacity-60 border border-[var(--border)] rounded-xl">${this.t('cancel')}</button>
                            <button onclick="app.saveRecord(${year},${month},${day})" class="flex-1 py-3 font-bold bg-[var(--primary)] text-white rounded-xl shadow-lg">${this.t('record_save')}</button>
                        </div>
                    </div>
                `);
            }

            _setSign(s) {
                this._recSign = s;
                const plus = document.getElementById('sign-plus');
                const minus = document.getElementById('sign-minus');
                const ja = this.state.lang === 'ja';
                if (!plus || !minus) return;
                if (s === 1) {
                    plus.className = 'flex-1 py-3 font-black text-sm bg-emerald-500 text-white transition';
                    minus.className = 'flex-1 py-3 font-black text-sm bg-[var(--bg-color)] text-red-400 transition';
                } else {
                    plus.className = 'flex-1 py-3 font-black text-sm bg-[var(--bg-color)] text-emerald-500 transition';
                    minus.className = 'flex-1 py-3 font-black text-sm bg-red-500 text-white transition';
                }
            }

            _pickResult(r) {
                this._pickedResult = r;
                ['win', 'loss', 'be'].forEach(v => {
                    const btn = document.getElementById('rb-' + v);
                    if (!btn) return;
                    if (v === r) btn.classList.add('border-current', 'shadow-md', 'scale-105');
                    else btn.classList.remove('border-current', 'shadow-md', 'scale-105');
                });
            }

            saveRecord(year, month, day) {
                const pnlEl = document.getElementById('rec-pnl');
                const noteEl = document.getElementById('rec-note');
                const rawAmt = Math.abs(parseFloat(pnlEl ? pnlEl.value : '0') || 0);
                const sign = this._recSign != null ? this._recSign : 1;
                const pnl = rawAmt * sign;
                const note = noteEl ? noteEl.value.trim() : '';
                let records = [];
                try { records = JSON.parse(localStorage.getItem(CONSTANTS.RECORDS_KEY) || '[]'); } catch (e) { }
                records.push({ id: Date.now(), year, month, day, pnl, note });
                localStorage.setItem(CONSTANTS.RECORDS_KEY, JSON.stringify(records));
                this._recSign = 1;
                this.closeModal(); this.render();
            }

            deleteRecord(id) {
                if (!confirm(this.t('record_confirm_delete'))) return;
                let records = [];
                try { records = JSON.parse(localStorage.getItem(CONSTANTS.RECORDS_KEY) || '[]'); } catch (e) { }
                records = records.filter(r => r.id !== id);
                localStorage.setItem(CONSTANTS.RECORDS_KEY, JSON.stringify(records));
                this.render();
            }

            deleteAllRecords(year, month, day) {
                const ja = this.state.lang === 'ja';
                const msg = ja ? `${year}\u5e74${month + 1}\u6708${day}\u65e5\u306e\u8a18\u9332\u3092\u5168\u3066\u524a\u9664\u3057\u307e\u3059\u304b\uff1f` : `Delete all records for ${year}/${month + 1}/${day}?`;
                if (!confirm(msg)) return;
                let records = [];
                try { records = JSON.parse(localStorage.getItem(CONSTANTS.RECORDS_KEY) || '[]'); } catch (e) { }
                records = records.filter(r => !(r.year === year && r.month === month && r.day === day));
                localStorage.setItem(CONSTANTS.RECORDS_KEY, JSON.stringify(records));
                this.render();
            }

            renderSettings() {
                const div = document.createElement('div');
                div.className = "space-y-6 fade-in pt-6 pb-20";
                const cur = this.state.lang === 'ja' ? 'Â¥' : '$';
                const themes = ['light', 'dark', 'gold'];
                const disabled = this.state.isLocked || !this.state.isPremium;
                div.innerHTML = `
                    <h2 class="text-3xl font-bold px-2 mb-2">${this.t('settings_title')}</h2>
                    <div class="card"><p class="text-sm font-bold opacity-60 mb-3 uppercase tracking-wider">${this.state.lang === 'ja' ? 'è¨€èª / LANGUAGE' : 'LANGUAGE'}</p>
                        <select onchange="app.setLang(this.value);" class="w-full bg-[var(--bg-color)] text-[var(--text-color)] font-bold px-4 py-3 rounded-xl border border-[var(--border)] focus:outline-none shadow-sm">
                            <option value="ja" ${this.state.lang === 'ja' ? 'selected' : ''}>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                            <option value="en" ${this.state.lang === 'en' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ English</option>
                            <option value="zh" ${this.state.lang === 'zh' ? 'selected' : ''}>ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                            <option value="ko" ${this.state.lang === 'ko' ? 'selected' : ''}>ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                            <option value="es" ${this.state.lang === 'es' ? 'selected' : ''}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                        </select>
                    </div>
                    <div class="card"><p class="text-sm font-bold opacity-60 mb-3 uppercase tracking-wider">${this.t('theme')}</p><div class="flex gap-3">${themes.map(t => `<button onclick="app.toggleTheme('${t}')" class="flex-1 py-4 text-xs font-bold rounded-xl border border-[var(--border)] ${this.state.theme === t ? 'bg-[var(--text-color)] text-[var(--bg-color)]' : 'bg-[var(--card-bg)]'}">${t.toUpperCase()}</button>`).join('')}</div></div>
                    <div>
                        <div class="card cursor-pointer" onclick="app.openNativeAppPicker()"><div class="flex justify-between items-center"><div><p class="font-bold text-xl mb-1">${this.t('blocked_apps')}</p><p class="text-sm opacity-60">${this.t('select')}</p></div><span class="text-4xl">ğŸ“±</span></div></div>
                        <p class="text-[11px] text-red-500 font-bold px-4 mt-2 leading-tight">${this.state.lang === 'ja' ? 'â€»è­¦å‘Šï¼šTrade Blockã¯é¸æŠã—ãªã„ã§ãã ã•ã„ã€‚å¼·åˆ¶è§£é™¤ãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' : 'âš ï¸ WARNING: Do NOT select Trade Block itself, or you will be permanently locked out.'}</p>
                    </div>
                    <div class="bg-[var(--card-bg)] rounded-xl overflow-hidden border border-[var(--border)] shadow-sm"><button onclick="app.showTutorial()" class="w-full p-4 text-left font-bold flex justify-between items-center border-b border-[var(--border)]"><span>ğŸ“š ${this.t('menu_tutorial')}</span><span>â€º</span></button><button onclick="app.showLegal()" class="w-full p-4 text-left font-bold flex justify-between items-center border-b border-[var(--border)]"><span>âš–ï¸ ${this.t('menu_legal')}</span><span>â€º</span></button><button onclick="app.showPrivacyPolicy()" class="w-full p-4 text-left font-bold flex justify-between items-center"><span>ğŸ” ${this.t('menu_privacy')}</span><span>â€º</span></button></div>
                    <div class="bg-[var(--card-bg)] rounded-xl overflow-hidden border border-[var(--border)] shadow-sm"><button onclick="app.restorePurchases()" class="w-full p-4 text-left font-bold flex justify-between items-center border-b border-[var(--border)]"><span>ğŸ”„ ${this.t('menu_restore')}</span><span>â€º</span></button><button onclick="app.openSubscriptionManagement()" class="w-full p-4 text-left font-bold flex justify-between items-center"><span>ğŸ“± ${this.t('menu_manage_sub')}</span><span>â€º</span></button></div>
                    ${!this.state.isPremium ? `<div onclick="app.showPremiumModal()" class="mt-2 bg-gradient-to-br from-[#111] to-[#333] p-8 rounded-2xl shadow-xl text-center border border-gray-700 cursor-pointer"><p class="text-4xl mb-3">ğŸ’</p><h3 class="text-[#D4AF37] font-black text-2xl mb-2">${this.t('premium_title')}</h3><p class="text-gray-400 font-bold">${this.t('upgrade_cta')}</p></div>` : ''}
                `;
                return div;
            }

            renderAppsPage() {
                const div = document.createElement('div');
                div.className = "flex flex-col h-full fade-in pb-20";
                div.innerHTML = `
                    <div class="flex items-center gap-4 mb-8 pt-4 px-2">
                        <button onclick="app.setPage('main')" class="w-12 h-12 rounded-full bg-[var(--card-bg)] border border-[var(--border)] flex items-center justify-center shadow-sm">
                            <span class="text-2xl font-bold">â†</span>
                        </button>
                        <h2 class="text-3xl font-black">${this.t('select_apps_title')}</h2>
                    </div>
                    <div class="space-y-4 overflow-y-auto px-1">
                        ${this.renderAppItem('MetaTrader 4', 'MetaQuotes', 'blue-500', 'MT4')}
                        ${this.renderAppItem('MetaTrader 5', 'MetaQuotes', 'blue-700', 'MT5')}
                        ${this.renderAppItem('TradingView', 'TradingView Inc.', 'black', 'TV')}
                        ${this.renderAppItem('cTrader', 'Spotware', 'emerald-600', 'cT')}
                        ${this.renderAppItem('Thinkorswim', 'Charles Schwab', 'green-700', 'ToS')}
                        ${this.renderAppItem('OANDA', 'OANDA Corp.', 'gray-700', 'OA')}
                        ${this.renderAppItem('IG Trading', 'IG Group', 'red-600', 'IG')}
                        ${this.renderAppItem('Plus500', 'Plus500 Ltd.', 'cyan-600', 'P5')}
                        ${this.renderAppItem('eToro', 'eToro Group', 'green-500', 'eT')}
                        ${this.renderAppItem('Robinhood', 'Robinhood Markets', 'green-400', 'RH')}
                        ${this.renderAppItem('Webull', 'Webull Corp.', 'orange-500', 'WB')}
                        ${this.renderAppItem('Interactive Brokers', 'IBKR', 'red-800', 'IB')}
                        ${this.renderAppItem('Coinbase', 'Coinbase Inc.', 'blue-600', 'CB')}
                        ${this.renderAppItem('Binance', 'Binance Holdings', 'yellow-500', 'BN')}
                        ${this.renderAppItem('bybit', 'Bybit', 'orange-400', 'BB')}
                        ${this.renderAppItem('bitFlyer', 'bitFlyer Inc.', 'blue-400', 'bF')}
                        ${this.renderAppItem('GMOã‚¯ãƒªãƒƒã‚¯è¨¼åˆ¸', 'GMO', 'blue-800', 'GMO')}
                        ${this.renderAppItem('DMM FX', 'DMM.com', 'red-500', 'DM')}
                        ${this.renderAppItem('SBIè¨¼åˆ¸', 'SBI Group', 'blue-900', 'SBI')}
                        ${this.renderAppItem('æ¥½å¤©è¨¼åˆ¸', 'Rakuten', 'red-700', 'æ¥½å¤©')}
                        ${this.renderAppItem('X / Twitter', 'Social', 'gray-800', 'X')}
                        ${this.renderAppItem('Instagram', 'Social', 'pink-500', 'IG')}
                    </div>
                `;
                return div;
            }

            renderAppItem(name, sub, color, icon) {
                const isOn = this.state.blockedApps.includes(name);
                return `
                <div class="card flex justify-between items-center border-l-4 ${isOn ? 'border-l-[var(--primary)]' : 'border-l-transparent opacity-60'}" onclick="app.toggleApp('${name.replace(/'/g, "\\'")}')"
                     style="cursor:pointer; transition: all 0.2s">
                    <div class="flex items-center gap-5">
                        <div class="w-14 h-14 rounded-2xl bg-${color} flex items-center justify-center text-white font-bold text-xl shadow-md">
                            ${icon}
                        </div>
                        <div>
                            <p class="font-bold text-xl text-[var(--text-color)]">${name}</p>
                            <p class="text-sm opacity-60">${sub}</p>
                        </div>
                    </div>
                    <div class="w-12 h-7 rounded-full relative transition-colors ${isOn ? 'bg-[var(--primary)]' : 'bg-gray-400'}" style="min-width: 48px">
                        <div class="absolute top-0.5 w-6 h-6 bg-white rounded-full shadow-md transition-all ${isOn ? 'left-[22px]' : 'left-0.5'}"></div>
                    </div>
                </div>`;
            }

            toggleApp(name) {
                const idx = this.state.blockedApps.indexOf(name);
                if (idx >= 0) this.state.blockedApps.splice(idx, 1);
                else this.state.blockedApps.push(name);
                this.save(); this.render();
            }

            showModal(html) {
                const con = document.getElementById('modal-container');
                con.innerHTML = `<div class="bg-[var(--card-bg)] w-full max-w-sm rounded-[32px] p-8 shadow-2xl border border-[var(--border)] relative overflow-hidden">${html}</div>`;
                con.classList.remove('hidden');
            }
            closeModal() { document.getElementById('modal-container').classList.add('hidden'); }
            completeTutorial() {
                this.state.hasSeenTutorial = true;
                this.save();
                this.closeModal();
                this.requestScreenTimeAuth();
            }
            showTutorial(page = 1) {
                let contentHTML = '';
                const isJa = this.state.lang === 'ja';

                if (page === 1) {
                    contentHTML = `
                        <div class="text-center mb-6">
                            <p class="text-4xl mb-2">ğŸ›¡ï¸</p>
                            <h4 class="font-bold text-xl text-[var(--primary)] mb-2">${this.t('tutorial_step1_title')}</h4>
                            <p class="text-xs opacity-80">${this.t('tutorial_step1_desc')}</p>
                        </div>
                        <div class="text-center mb-6">
                            <p class="text-4xl mb-2">ğŸ†</p>
                            <h4 class="font-bold text-xl text-[var(--primary)] mb-2">${this.t('tutorial_step2_title')}</h4>
                            <p class="text-xs opacity-80">${this.t('tutorial_step2_desc')}</p>
                        </div>
                        <div class="text-center mb-6">
                            <p class="text-4xl mb-2">âš ï¸</p>
                            <h4 class="font-bold text-xl text-[var(--danger)] mb-2">${this.t('tutorial_step3_title')}</h4>
                            <p class="text-xs opacity-80">${this.t('tutorial_step3_desc')}</p>
                        </div>
                        <button onclick="app.showTutorial(2)" class="btn btn-primary w-full py-4 shadow-xl text-lg mt-2">${isJa ? 'æ¬¡ã¸' : 'Next'}</button>
                    `;
                } else if (page === 2) {
                    contentHTML = `
                        <div class="text-center mb-6 mt-4">
                            <p class="text-5xl mb-4">ğŸ“±</p>
                            <h4 class="font-bold text-2xl text-[var(--primary)] mb-4">${this.t('tutorial_step5_title')}</h4>
                            <p class="text-sm opacity-90 leading-relaxed text-left bg-[var(--bg-color)] p-5 rounded-xl border border-[var(--border)] shadow-inner">${this.t('tutorial_step5_desc')}</p>
                        </div>
                        <div class="flex gap-3 mt-8">
                            <button onclick="app.showTutorial(1)" class="btn flex-1 py-4 opacity-70 bg-[var(--bg-color)] border border-[var(--border)] rounded-xl shadow">${this.t('back')}</button>
                            <button onclick="app.showTutorial(3)" class="btn btn-primary flex-[2] py-4 shadow-xl text-lg">${isJa ? 'æ¬¡ã¸' : 'Next'}</button>
                        </div>
                    `;
                } else {
                    contentHTML = `
                        <div class="text-center mb-6 mt-4">
                            <p class="text-5xl mb-4">ğŸ”</p>
                            <h4 class="font-bold text-2xl text-blue-500 mb-4">${this.t('tutorial_step4_title')}</h4>
                            <p class="text-sm opacity-90 leading-relaxed text-left bg-[var(--bg-color)] p-5 rounded-xl border border-[var(--border)] shadow-inner">${this.t('tutorial_step4_desc')}</p>
                            <p class="text-xs text-[var(--accent-gold)] mt-6 font-bold bg-[var(--accent-gold)]/10 p-3 rounded-lg border border-[var(--accent-gold)]/30">${isJa ? 'â€»ã“ã®ç”»é¢ã‚’é–‰ã˜ã‚‹ã¨è¨­å®šã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™' : '*A system popup will appear after closing this screen.'}</p>
                        </div>
                        <div class="flex gap-3 mt-8">
                            <button onclick="app.showTutorial(2)" class="btn flex-1 py-4 opacity-70 bg-[var(--bg-color)] border border-[var(--border)] rounded-xl shadow">${this.t('back')}</button>
                            <button onclick="app.completeTutorial()" class="btn btn-primary flex-[2] py-4 shadow-xl text-lg animate-pulse">${isJa ? 'é–‰ã˜ã¦é€²ã‚€' : 'Close & Continue'}</button>
                        </div>
                    `;
                }

                this.showModal(`
                    <div class="space-y-4 pb-2">
                        <h3 class="text-2xl font-black text-center mb-4">${this.t('tutorial_title')}</h3>
                        <div class="flex justify-center gap-2 mb-6 px-4">
                            <div class="h-1.5 flex-1 rounded-full ${page >= 1 ? 'bg-[var(--primary)]' : 'bg-[var(--border)]'} transition-colors"></div>
                            <div class="h-1.5 flex-1 rounded-full ${page >= 2 ? 'bg-[var(--primary)]' : 'bg-[var(--border)]'} transition-colors"></div>
                            <div class="h-1.5 flex-1 rounded-full ${page >= 3 ? 'bg-[var(--primary)]' : 'bg-[var(--border)]'} transition-colors"></div>
                        </div>
                        ${contentHTML}
                    </div>
                `);
            }
            showLegal() { this.showModal(`<div class="text-left"><h3 class="text-2xl font-black mb-4 text-center">${this.t('legal_title')}</h3><div class="h-64 overflow-y-auto bg-white/5 p-4 rounded-xl border border-white/10 mb-4 prose prose-invert prose-sm">${this.t('legal_text')}</div><button onclick="app.closeModal()" class="btn w-full py-3 opacity-80 bg-[var(--card-bg)] border border-[var(--border)]">${this.t('back')}</button></div>`); }
            showPrivacyPolicy() { this.showModal(`<div class="text-left"><h3 class="text-2xl font-black mb-4 text-center">${this.t('privacy_title')}</h3><div class="h-64 overflow-y-auto bg-white/5 p-4 rounded-xl border border-white/10 mb-4 prose prose-invert prose-sm">${this.t('privacy_text')}</div><button onclick="app.closeModal()" class="btn w-full py-3 opacity-80 bg-[var(--card-bg)] border border-[var(--border)]">${this.t('back')}</button></div>`); }
            async restorePurchases() {
                try {
                    if (window.Capacitor && Capacitor.Plugins.StoreKit) {
                        const result = await Capacitor.Plugins.StoreKit.restorePurchases();
                        if (result.restored) {
                            this.state.isPremium = true;
                            this.state.page = 'main'; // Dismiss paywall on restore
                            document.getElementById('paywall-container')?.remove();
                            if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                            this.save(); this.render(); alert(this.t('restore_success'));
                        }
                        else { alert(this.t('restore_none')); }
                    } else if (!IS_PRODUCTION) {
                        // Dev fallback
                        this.state.isPremium = true; this.state.page = 'main';
                        document.getElementById('paywall-container')?.remove();
                        if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                        this.save(); this.render(); alert('[DEV] Premium Restored.');
                    } else { alert(this.t('restore_none')); }
                } catch (e) { alert(this.t('restore_none')); }
            }
            openSubscriptionManagement() {
                if (window.Capacitor && Capacitor.Plugins.StoreKit) {
                    Capacitor.Plugins.StoreKit.openSubscriptionManagement();
                } else {
                    window.open('https://apps.apple.com/account/subscriptions', '_blank');
                }
            }
            formatDuration(min) {
                if (this.state.lang === 'en') {
                    if (min < 60) return min + "m";
                    const h = Math.floor(min / 60);
                    const m = min % 60;
                    return `${h}h ${m}m`;
                } else {
                    if (min < 60) return min + "åˆ†";
                    const h = Math.floor(min / 60);
                    const m = min % 60;
                    return `${h}æ™‚é–“${m}åˆ†`;
                }
            }
            setDuration(val) {
                this.state.duration = parseInt(val);
                this.save();
                const el = document.getElementById('timer-text');
                if (el) el.innerText = this.formatDuration(this.state.duration);
            }
            updateTimerUI(ms) {
                const totalSec = Math.floor(ms / 1000);
                const h = Math.floor(totalSec / 3600);
                const m = Math.floor((totalSec % 3600) / 60);
                const s = totalSec % 60;
                const el = document.getElementById('timer-text');
                if (el) {
                    if (h > 0) el.innerText = `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                    else el.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                }
            }
            showPaymentModal() {
                // Pick a random question set
                const sets = QUESTION_SETS[this.state.lang];
                this._currentQSet = sets[Math.floor(Math.random() * sets.length)];
                this.showUnlockQuestion(0);
            }
            showUnlockQuestion(step) {
                const qs = this._currentQSet;
                const total = qs.length;
                const isLast = step === total - 1;
                const ja = this.state.lang === 'ja';
                const waitSec = 5;
                const emojis = ['ğŸ¤”', 'ğŸ˜°', 'ğŸ“Š', 'ğŸ’°', 'ğŸ§ '];

                let html = `<div class="text-center mb-2 text-xs font-bold opacity-50 tracking-widest uppercase">${ja ? 'å†·å´æœŸé–“ãƒã‚§ãƒƒã‚¯' : 'Discipline Check'} ${step + 1} / ${total}</div>`;
                html += `<div class="w-full bg-black/10 rounded-full h-1 mb-5"><div class="bg-[var(--danger)] h-1 rounded-full transition-all duration-500" style="width:${((step + 1) / total) * 100}%"></div></div>`;

                // 5th question: if memo exists, skip question â€” show memo + quote only
                const skipQuestion = isLast && !!this.state.memo;
                if (!skipQuestion) {
                    html += `<div class="text-center py-4 mb-3"><p class="text-4xl mb-3">${emojis[step]}</p><p class="font-black text-base leading-relaxed">${qs[step]}</p></div>`;
                }

                if (isLast) {
                    // Show user memo if set
                    if (this.state.memo) {
                        html += `<div class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-xl mb-3 text-left"><p class="text-xs font-black opacity-60 mb-1">ğŸ“ ${this.t('memo_in_unlock')}</p><p class="text-sm font-bold leading-relaxed">${this.state.memo.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p></div>`;
                    }
                    // Always show a random investor quote on last step
                    const qPool = QUOTES[this.state.lang];
                    const quote = qPool[Math.floor(Math.random() * qPool.length)];
                    html += `<div class="p-3 bg-[var(--card-bg)] border border-[var(--border)] rounded-xl mb-3 text-center"><p class="text-sm italic opacity-80 mb-1">â€œ${quote.text}â€</p><p class="text-xs font-black opacity-50">â€” ${quote.author}</p></div>`;
                }

                const noLabel = ja ? 'ã„ã„ãˆï¼ˆä¸­æ­¢ï¼‰' : 'No (Cancel)';
                const yesBase = isLast ? (ja ? 'ã¯ã„ â€” è§£é™¤ã™ã‚‹' : 'Yes â€” Unlock') : (ja ? 'ã¯ã„ â€” æ¬¡ã¸' : 'Yes â€” Next');
                html += `<div class="flex gap-3 mt-2">`;
                html += `<button onclick="app.closeModal()" class="flex-1 py-4 font-bold opacity-70 border border-[var(--border)] rounded-xl">${noLabel}</button>`;
                html += `<button id="q-yes-btn" disabled onclick="${isLast ? 'app.processQuestionUnlock()' : `app.showUnlockQuestion(${step + 1})`}" class="flex-1 py-4 font-bold bg-[var(--danger)] text-white rounded-xl opacity-40 cursor-not-allowed transition-all"><span id="q-yes-label">${ja ? `ç¢ºèªä¸­... (${waitSec})` : `Reading... (${waitSec})`}</span></button>`;
                html += `</div>`;

                this.showModal(html);

                let remaining = waitSec;
                const tick = setInterval(() => {
                    remaining--;
                    const lbl = document.getElementById('q-yes-label');
                    const btn = document.getElementById('q-yes-btn');
                    if (!lbl || !btn) { clearInterval(tick); return; }
                    if (remaining > 0) {
                        lbl.textContent = ja ? `ç¢ºèªä¸­... (${remaining})` : `Reading... (${remaining})`;
                    } else {
                        clearInterval(tick);
                        btn.disabled = false;
                        btn.classList.remove('opacity-40', 'cursor-not-allowed');
                        btn.classList.add('shadow-lg');
                        lbl.textContent = yesBase;
                    }
                }, 1000);
            }
            async processQuestionUnlock() {
                const date = new Date().toLocaleString();
                this.state.history.unshift({ date, type: 'force_unlock' });
                this.state.memo = ''; // clear memo after unlock
                this.save();
                this._forceUnlocked = true;
                this.unlock(); this.closeModal();
                this._forceUnlocked = false;
            }
            editMemo() {
                const ja = this.state.lang === 'ja';
                const cur = this.state.memo || '';
                this.showModal(`
                    <h3 class="text-xl font-black mb-4">ğŸ“ ${this.t('memo_label')}</h3>
                    <textarea id="memo-input" rows="4" placeholder="${this.t('memo_placeholder')}" class="w-full p-3 rounded-xl border border-[var(--border)] bg-[var(--bg-color)] text-[var(--text-color)] font-bold text-sm resize-none focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">${cur.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    <div class="flex gap-3 mt-4">
                        <button onclick="app.closeModal()" class="flex-1 py-4 font-bold opacity-70 border border-[var(--border)] rounded-xl">${this.t('cancel')}</button>
                        <button onclick="app.saveMemo()" class="flex-1 py-4 font-bold bg-[var(--primary)] text-white rounded-xl shadow-lg">${ja ? 'ä¿å­˜' : 'Save'}</button>
                    </div>
                `);
            }
            saveMemo() {
                const el = document.getElementById('memo-input');
                if (el) { this.state.memo = el.value.trim(); this.save(); }
                this.closeModal(); this.render();
            }
            renderPaywall() {
                const div = document.createElement('div');
                div.className = "fixed inset-0 z-50 flex flex-col h-full bg-gradient-to-br from-[#000] to-[#1a1a1a] text-white p-4 justify-center fade-in bg-black overflow-y-auto no-scrollbar";
                div.style.paddingTop = "calc(env(safe-area-inset-top) + 0.5rem)";
                div.style.paddingBottom = "calc(env(safe-area-inset-bottom) + 1rem)";

                const ja = this.state.lang === 'ja';
                const sub_notice = ja
                    ? `â€»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¯è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚è§£ç´„ã¯ã‚¢ãƒƒãƒ—ãƒ«è¨­å®šç”»é¢ã‹ã‚‰ã„ã¤ã§ã‚‚å¯èƒ½`
                    : `*Subscriptions auto-renew. Cancel anytime in Apple ID settings.`;
                div.innerHTML = `
                    <div class="flex-1 flex flex-col justify-start items-center text-center max-w-md mx-auto w-full pt-4">
                        <div class="w-full flex justify-end pb-4">
                            <select onchange="app.setLang(this.value); app.renderPaywallAndMount()" class="bg-black/50 text-white text-xs px-3 py-1.5 rounded-full border border-white/20 focus:outline-none shadow-sm">
                                <option value="ja" ${ja ? 'selected' : ''}>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                                <option value="en" ${!ja && this.state.lang !== 'zh' && this.state.lang !== 'es' && this.state.lang !== 'ko' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ English</option>
                                <option value="zh" ${this.state.lang === 'zh' ? 'selected' : ''}>ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                                <option value="ko" ${this.state.lang === 'ko' ? 'selected' : ''}>ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                                <option value="es" ${this.state.lang === 'es' ? 'selected' : ''}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                            </select>
                        </div>
                        <p class="text-6xl mt-0 mb-3 drop-shadow-[0_0_15px_rgba(212,175,55,0.8)]">&#x1F3C6;</p>
                        <h3 class="text-3xl font-black mb-2 text-[#D4AF37] tracking-tight drop-shadow-md">${this.t('premium_headline')}</h3>
                        <p class="text-sm font-bold opacity-90 mb-6">${this.t('premium_subhead')}</p>
                        
                        <div class="text-left bg-gradient-to-br from-[#111] to-[#222] p-5 rounded-xl border border-[#D4AF37]/50 mb-8 shadow-[0_0_20px_rgba(212,175,55,0.15)] w-full relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-[#D4AF37] opacity-5 rounded-full blur-2xl transform translate-x-10 -translate-y-10"></div>
                            <ul class="text-xs text-gray-200 space-y-4 font-bold relative z-10">
                                <li class="flex items-start gap-3"><span class="text-[#D4AF37] text-base drop-shadow-[0_0_5px_rgba(212,175,55,0.8)]">âœ“</span> <span class="leading-snug">${this.t('premium_feature1')}</span></li>
                                <li class="flex items-start gap-3"><span class="text-[#D4AF37] text-base drop-shadow-[0_0_5px_rgba(212,175,55,0.8)]">âœ“</span> <span class="leading-snug">${this.t('premium_feature2')}</span></li>
                                <li class="flex items-start gap-3"><span class="text-[#D4AF37] text-base drop-shadow-[0_0_5px_rgba(212,175,55,0.8)]">âœ“</span> <span class="leading-snug">${this.t('premium_feature3')}</span></li>
                            </ul>
                        </div>

                        <div class="space-y-4 w-full mb-8 relative">
                            <button id="plan-monthly" onclick="app.selectPremiumPlan('com.shota.tradeblock.premium.monthly')" class="w-full relative overflow-hidden rounded-xl p-5 flex justify-between items-center transition-all text-left ${this._selPlan === 'com.shota.tradeblock.premium.monthly' ? 'border-2 border-[#D4AF37] scale-[1.02] shadow-[0_0_15px_rgba(212,175,55,0.3)] bg-[#222]' : 'border border-gray-700 hover:border-gray-500 bg-[#1f1f1f] scale-100 opacity-80'}">
                                <span class="absolute top-0 right-0 bg-blue-600 shadow-sm text-[10px] text-white font-black py-1 px-3 rounded-bl-xl tracking-wider z-10">${ja ? '7æ—¥é–“ç„¡æ–™' : '7-DAY FREE TRIAL'}</span>
                                <span class="font-bold text-sm text-white flex-1">${this.t('sub_monthly')}</span>
                                <span class="font-black text-xl text-[#D4AF37] drop-shadow-sm">${this.t('sub_monthly_price')}</span>
                            </button>
                            <button id="plan-annual" onclick="app.selectPremiumPlan('com.shota.tradeblock.premium.annual')" class="w-full relative overflow-hidden rounded-xl p-5 flex justify-between items-center transition-all text-left ${this._selPlan === 'com.shota.tradeblock.premium.annual' ? 'border-2 border-[#D4AF37] scale-[1.02] shadow-[0_0_20px_rgba(212,175,55,0.4)] bg-gradient-to-br from-[#332a15] to-[#111]' : 'border border-gray-700 hover:border-gray-500 bg-gradient-to-br from-[#2a2211] to-[#111] scale-100 opacity-80'}">
                                <div class="absolute top-0 right-0 bg-red-600 shadow-sm text-[10px] font-black py-1 px-3 rounded-bl-xl tracking-wider z-10 animate-pulse">BEST VALUE</div>
                                <span class="font-bold text-sm text-white flex-1">${this.t('sub_annual')}</span>
                                <span class="font-black text-xl text-[#D4AF37] drop-shadow-md">${this.t('sub_annual_price')}</span>
                            </button>
                            <button id="plan-lifetime" onclick="app.selectPremiumPlan('com.shota.tradeblock.premium.lifetime')" class="w-full relative overflow-hidden rounded-xl p-5 flex justify-between items-center transition-all text-left ${this._selPlan === 'com.shota.tradeblock.premium.lifetime' ? 'border-2 border-[#D4AF37] scale-[1.02] shadow-[0_0_15px_rgba(212,175,55,0.3)] bg-[#1a1a1a]' : 'border border-gray-700 hover:border-gray-500 bg-[#1a1a1a] scale-100 opacity-80'}">
                                <span class="font-bold text-sm text-white flex-1">${this.t('sub_lifetime')}</span>
                                <span class="font-black text-xl text-[#D4AF37] drop-shadow-sm">${this.t('sub_lifetime_price')}</span>
                            </button>
                            
                            <button onclick="app.activatePremium(app._selPlan)" class="w-full mt-8 py-5 rounded-2xl font-black text-2xl tracking-wide text-[#000] bg-gradient-to-r from-[#FFE082] via-[#E2B743] to-[#B7892B] shadow-[0_0_25px_rgba(212,175,55,0.6)] active:scale-95 transition-transform animate-[pulse_2s_ease-in-out_infinite] border border-white/40">${ja ? 'é¸æŠã—ãŸãƒ—ãƒ©ãƒ³ã§å§‹ã‚ã‚‹' : 'Subscribe Now'}</button>
                        </div>

                        <div class="text-[9px] opacity-40 mb-4 leading-relaxed px-4 w-full">${sub_notice}</div>
                        
                        <div class="flex flex-col gap-3 w-full px-8 mt-auto">
                            <button onclick="app.restorePurchases()" class="btn w-full py-1.5 font-bold opacity-60 text-[10px] bg-transparent border border-white/20">${this.t('menu_restore')}</button>
                            <div class="flex justify-center gap-4 text-[10px] font-bold opacity-40">
                                <span onclick="app.showPrivacyPolicy()" class="cursor-pointer underline leading-none py-1">${this.t('menu_privacy')}</span>
                                <span onclick="app.showLegal()" class="cursor-pointer underline leading-none py-1">Terms</span>
                            </div>
                        </div>
                    </div>
                `;
                return div;
            }
            selectPremiumPlan(planId) {
                this._selPlan = planId;
                const plans = ['monthly', 'annual', 'lifetime'];
                plans.forEach(p => {
                    const el = document.getElementById('plan-' + p);
                    if (!el) return;
                    if ('com.shota.tradeblock.premium.' + p === planId) {
                        el.className = `w-full relative overflow-hidden rounded-xl p-5 flex justify-between items-center transition-all text-left border-2 border-[#D4AF37] scale-[1.02] shadow-[0_0_20px_rgba(212,175,55,0.4)] ${p === 'annual' ? 'bg-gradient-to-br from-[#332a15] to-[#111]' : 'bg-[#222]'}`;
                    } else {
                        el.className = `w-full relative overflow-hidden rounded-xl p-5 flex justify-between items-center transition-all text-left border border-gray-700 hover:border-gray-500 scale-100 opacity-80 ${p === 'annual' ? 'bg-gradient-to-br from-[#2a2211] to-[#111]' : 'bg-[#1f1f1f]'}`;
                    }
                });
            }
            renderPaywallAndMount() {
                if (!this._selPlan) this._selPlan = 'com.shota.tradeblock.premium.monthly';
                const modalWrapper = document.getElementById('paywall-container') || (() => {
                    const el = document.createElement('div');
                    el.id = 'paywall-container';
                    document.body.appendChild(el);
                    return el;
                })();
                modalWrapper.innerHTML = '';
                modalWrapper.appendChild(this.renderPaywall());
            }
            showPremiumModal() {
                this.render(); // If called from within the app, just reload state which triggers paywall if not premium
            }
            async activatePremium(productId) {
                try {
                    if (window.Capacitor && Capacitor.Plugins.StoreKit) {
                        const result = await Capacitor.Plugins.StoreKit.purchase({ productId: productId });
                        if (result.success) {
                            this.state.isPremium = true; this.state.page = 'main'; this.save(); this.render(); this.closeModal();
                            document.getElementById('paywall-container')?.remove();
                            setTimeout(() => {
                                if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                                else { alert(this.state.lang === 'ja' ? 'PREMIUMã¸ã‚ˆã†ã“ãï¼' : 'WELCOME TO PREMIUM!'); }
                            }, 500);
                        } else {
                            if (!IS_PRODUCTION) {
                                this.state.isPremium = true; this.state.page = 'main'; this.save(); this.render(); this.closeModal();
                                document.getElementById('paywall-container')?.remove();
                                if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                                alert('[DEV BYPASS] Request failed but IS_PRODUCTION is false. Unlocking.');
                            }
                        }
                    } else if (!IS_PRODUCTION) {
                        this.state.isPremium = true; this.state.page = 'main'; this.save(); this.render(); this.closeModal();
                        document.getElementById('paywall-container')?.remove();
                        if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                        alert('[DEV] Premium activated without Store.');
                    }
                } catch (e) {
                    if (!IS_PRODUCTION) {
                        this.state.isPremium = true; this.state.page = 'main'; this.save(); this.render(); this.closeModal();
                        document.getElementById('paywall-container')?.remove();
                        if (!this.state.hasSeenTutorial) { this.showTutorial(1); }
                        alert('[DEV BYPASS CAUGHT ERR] Unlocking. Error: ' + e.message);
                    } else {
                        alert('Purchase error: ' + e.message);
                    }
                }
            }
            showLockConfirm() {
                if (!this.state.isPremium) { this.showPremiumModal(); return; }
                const ja = this.state.lang === 'ja';
                this.showModal(`
                    <h3 class="text-2xl font-black mb-4">${this.t('confirm_title')}</h3>
                    <p class="opacity-70 mb-4 font-bold leading-relaxed text-sm">${this.t('confirm_desc')}</p>
                    <div class="space-y-3 bg-[var(--bg-color)] p-4 rounded-xl mb-4">
                        <div class="flex items-center gap-3"><span class="text-2xl">ğŸš«</span><span class="font-bold text-sm">${this.t('risk_1')}</span></div>
                        <div class="flex items-center gap-3"><span class="text-2xl">âš ï¸</span><span class="font-bold text-sm">${this.t('risk_2')}</span></div>
                    </div>
                    <div class="mb-4">
                        <label class="text-xs font-black opacity-60 block mb-2">ğŸ“ ${this.t('memo_label')} (${ja ? 'ä»»æ„' : 'Optional'})</label>
                        <textarea id="lock-memo-input" rows="3" placeholder="${this.t('memo_placeholder')}" class="w-full p-3 rounded-xl border border-[var(--border)] bg-[var(--bg-color)] text-[var(--text-color)] font-bold text-sm resize-none focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">${(this.state.memo || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="app.closeModal()" class="flex-1 py-4 font-bold opacity-60">${this.t('cancel')}</button>
                        <button onclick="app.confirmLock()" class="flex-1 py-4 bg-[var(--danger)] text-white font-bold rounded-xl shadow-lg">${this.t('confirm')}</button>
                    </div>
                `);
            }
            async confirmLock() {
                // Save memo from lock-confirm textarea if present
                const memoEl = document.getElementById('lock-memo-input');
                if (memoEl) this.state.memo = memoEl.value.trim();
                this.state.lockEndTime = Date.now() + (this.state.duration * 60 * 1000);
                this.state.isLocked = true; this.save(); this.closeModal();
                if (window.Capacitor && Capacitor.Plugins.ScreenTime) {
                    try { await Capacitor.Plugins.ScreenTime.blockApps(); } catch (e) { console.error(e); }
                }
                this.render();
            }
            async triggerSecureProfit() {
                if (!this.state.isPremium) { this.showPremiumModal(); return; }
                if (confirm(this.t('secure_confirm'))) {
                    const now = new Date(); let target = new Date();
                    target.setHours(CONSTANTS.SECURE_PROFIT_HOUR, 0, 0, 0);
                    if (now >= target) target.setDate(target.getDate() + 1);
                    this.state.lockEndTime = target.getTime();
                    this.state.isLocked = true; this.save();
                    // Block apps via Screen Time
                    if (window.Capacitor && Capacitor.Plugins.ScreenTime) {
                        try { await Capacitor.Plugins.ScreenTime.blockApps(); } catch (e) { console.error(e); }
                    }
                    this.render();
                }
            }
        }

        const app = new TradeGuardApp();
    </script>
</body>

</html>